{"version":3,"file":"scramjet.client.js","sources":["webpack://@mercuryworkshop/scramjet/./src/client/client.ts","webpack://@mercuryworkshop/scramjet/./src/client/document.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/attr.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/beacon.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/cookie.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/css.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/document.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/element.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/fontface.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/history.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/navigation.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/open.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/origin.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/performance.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/serviceworker.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/storage.ts","webpack://@mercuryworkshop/scramjet/./src/client/events.ts","webpack://@mercuryworkshop/scramjet/./src/client/global.ts","webpack://@mercuryworkshop/scramjet/./src/client/helpers.ts","webpack://@mercuryworkshop/scramjet/./src/client/index.ts","webpack://@mercuryworkshop/scramjet/./src/client/location.ts","webpack://@mercuryworkshop/scramjet/./src/client/natives.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/antiantidebugger.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/blob.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/caches.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/err.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/error.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/eval.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/event.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/function.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/import.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/indexeddb.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/opfs.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/postmessage.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/realm.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/requests/eventsource.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/requests/fetch.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/requests/websocket.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/requests/xmlhttprequest.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/sourcemaps.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/trustedTypes.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/unproxy.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/worker.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/wrap.ts","webpack://@mercuryworkshop/scramjet/./src/client/swruntime.ts","webpack://@mercuryworkshop/scramjet/./src/client/worker/importScripts.ts","webpack://@mercuryworkshop/scramjet/./src/log.ts","webpack://@mercuryworkshop/scramjet/./src/scramjet.ts","webpack://@mercuryworkshop/scramjet/./src/shared.ts","webpack://@mercuryworkshop/scramjet/./src/shared/rewriters/js.ts","webpack://@mercuryworkshop/scramjet/./src/shared/rewriters/url.ts","webpack://@mercuryworkshop/scramjet/./src/symbols.ts","webpack://@mercuryworkshop/scramjet/./rewriter/wasm/out/snippets/wasm-4b0f351a8e6eeb46/inline0.js","webpack://@mercuryworkshop/scramjet/./rewriter/wasm/out/wasm.js"],"sourcesContent":["import { iswindow } from \".\";\nimport { ScramjetFrame } from \"../controller/frame\";\nimport { SCRAMJETCLIENT, SCRAMJETFRAME } from \"../symbols\";\nimport { createDocumentProxy } from \"./document\";\nimport { createGlobalProxy } from \"./global\";\nimport { getOwnPropertyDescriptorHandler } from \"./helpers\";\nimport { createLocationProxy } from \"./location\";\nimport { nativeGetOwnPropertyDescriptor } from \"./natives\";\nimport {\n\tBareClient,\n\tCookieStore,\n\tconfig,\n\tunrewriteUrl,\n\trewriteUrl,\n} from \"../shared\";\nimport type { BareClient as BareClientType } from \"@mercuryworkshop/bare-mux\";\nimport { createWrapFn } from \"./shared/wrap\";\nimport { NavigateEvent } from \"./events\";\nimport type { URLMeta } from \"../shared/rewriters/url\";\nimport { SourceMaps } from \"./shared/sourcemaps\";\n\ntype NativeStore = {\n\tstore: Record<string, any>;\n\tcall: (target: string, that: any, ...args) => any;\n\tconstruct: (target: string, ...args) => any;\n};\ntype DescriptorStore = {\n\tstore: Record<string, PropertyDescriptor>;\n\tget: (target: string, that: any) => any;\n\tset: (target: string, that: any, value: any) => void;\n};\n//eslint-disable-next-line\nexport type AnyFunction = Function;\n\nexport type ScramjetModule = {\n\tenabled: (client: ScramjetClient) => boolean | undefined;\n\tdisabled: (\n\t\tclient: ScramjetClient,\n\t\tself: typeof globalThis\n\t) => void | undefined;\n\torder: number | undefined;\n\tdefault: (client: ScramjetClient, self: typeof globalThis) => void;\n};\n\nexport type ProxyCtx = {\n\tfn: AnyFunction;\n\tthis: any;\n\targs: any[];\n\tnewTarget: AnyFunction;\n\treturn: (r: any) => void;\n\tcall: () => any;\n};\nexport type Proxy = {\n\tconstruct?(ctx: ProxyCtx): any;\n\tapply?(ctx: ProxyCtx): any;\n};\n\nexport type TrapCtx<T> = {\n\tthis: any;\n\tget: () => T;\n\tset: (v: T) => void;\n};\nexport type Trap<T> = {\n\twritable?: boolean;\n\tvalue?: any;\n\tenumerable?: boolean;\n\tconfigurable?: boolean;\n\tget?: (ctx: TrapCtx<T>) => T;\n\tset?: (ctx: TrapCtx<T>, v: T) => void;\n};\n\nexport class ScramjetClient {\n\tdocumentProxy: any;\n\tglobalProxy: any;\n\tlocationProxy: any;\n\tserviceWorker: ServiceWorkerContainer;\n\tbare: BareClientType;\n\n\tnatives: NativeStore;\n\tdescriptors: DescriptorStore;\n\tsourcemaps: SourceMaps;\n\twrapfn: (i: any, ...args: any) => any;\n\n\tcookieStore = new CookieStore();\n\n\teventcallbacks: Map<\n\t\tany,\n\t\t[\n\t\t\t{\n\t\t\t\tevent: string;\n\t\t\t\toriginalCallback: AnyFunction;\n\t\t\t\tproxiedCallback: AnyFunction;\n\t\t\t},\n\t\t]\n\t> = new Map();\n\n\tmeta: URLMeta;\n\n\tconstructor(public global: typeof globalThis) {\n\t\tif (SCRAMJETCLIENT in global) {\n\t\t\tconsole.error(\n\t\t\t\t\"attempted to initialize a scramjet client, but one is already loaded - this is very bad\"\n\t\t\t);\n\t\t\tthrow new Error();\n\t\t}\n\n\t\tif (iswindow) {\n\t\t\tthis.bare = new BareClient();\n\t\t} else {\n\t\t\tthis.bare = new BareClient(\n\t\t\t\tnew Promise((resolve) => {\n\t\t\t\t\taddEventListener(\"message\", ({ data }) => {\n\t\t\t\t\t\tif (typeof data !== \"object\") return;\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\"$scramjet$type\" in data &&\n\t\t\t\t\t\t\tdata.$scramjet$type === \"baremuxinit\"\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tresolve(data.port);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\tthis.serviceWorker = this.global.navigator.serviceWorker;\n\n\t\tif (iswindow) {\n\t\t\tthis.documentProxy = createDocumentProxy(this, global);\n\n\t\t\tglobal.document[SCRAMJETCLIENT] = this;\n\t\t}\n\n\t\tthis.locationProxy = createLocationProxy(this, global);\n\t\tthis.globalProxy = createGlobalProxy(this, global);\n\t\tthis.wrapfn = createWrapFn(this, global);\n\t\tthis.sourcemaps = {};\n\t\tthis.natives = {\n\t\t\tstore: new Proxy(\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\tget: (target, prop: string) => {\n\t\t\t\t\t\tif (prop in target) {\n\t\t\t\t\t\t\treturn target[prop];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst split = prop.split(\".\");\n\t\t\t\t\t\tconst realProp = split.pop();\n\t\t\t\t\t\tconst realTarget = split.reduce((a, b) => a?.[b], this.global);\n\n\t\t\t\t\t\tif (!realTarget) return;\n\n\t\t\t\t\t\tconst original = Reflect.get(realTarget, realProp);\n\t\t\t\t\t\ttarget[prop] = original;\n\n\t\t\t\t\t\treturn target[prop];\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t),\n\t\t\tconstruct(target: string, ...args) {\n\t\t\t\tconst original = this.store[target];\n\t\t\t\tif (!original) return null;\n\n\t\t\t\treturn new original(...args);\n\t\t\t},\n\t\t\tcall(target: string, that: any, ...args) {\n\t\t\t\tconst original = this.store[target];\n\t\t\t\tif (!original) return null;\n\n\t\t\t\treturn original.call(that, ...args);\n\t\t\t},\n\t\t};\n\t\tthis.descriptors = {\n\t\t\tstore: new Proxy(\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\tget: (target, prop: string) => {\n\t\t\t\t\t\tif (prop in target) {\n\t\t\t\t\t\t\treturn target[prop];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst split = prop.split(\".\");\n\t\t\t\t\t\tconst realProp = split.pop();\n\t\t\t\t\t\tconst realTarget = split.reduce((a, b) => a?.[b], this.global);\n\n\t\t\t\t\t\tif (!realTarget) return;\n\n\t\t\t\t\t\tconst original = nativeGetOwnPropertyDescriptor(\n\t\t\t\t\t\t\trealTarget,\n\t\t\t\t\t\t\trealProp\n\t\t\t\t\t\t);\n\t\t\t\t\t\ttarget[prop] = original;\n\n\t\t\t\t\t\treturn target[prop];\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t),\n\t\t\tget(target: string, that: any) {\n\t\t\t\tconst original = this.store[target];\n\t\t\t\tif (!original) return null;\n\n\t\t\t\treturn original.get.call(that);\n\t\t\t},\n\t\t\tset(target: string, that: any, value: any) {\n\t\t\t\tconst original = this.store[target];\n\t\t\t\tif (!original) return null;\n\n\t\t\t\toriginal.set.call(that, value);\n\t\t\t},\n\t\t};\n\t\t// eslint-disable-next-line @typescript-eslint/no-this-alias\n\t\tconst client = this;\n\t\tthis.meta = {\n\t\t\tget origin() {\n\t\t\t\treturn client.url;\n\t\t\t},\n\t\t\tget base() {\n\t\t\t\tif (iswindow) {\n\t\t\t\t\tconst base = client.natives.call(\n\t\t\t\t\t\t\"Document.prototype.querySelector\",\n\t\t\t\t\t\tclient.global.document,\n\t\t\t\t\t\t\"base\"\n\t\t\t\t\t);\n\t\t\t\t\tif (base) {\n\t\t\t\t\t\tlet url = base.getAttribute(\"href\");\n\t\t\t\t\t\tconst frag = url.indexOf(\"#\");\n\t\t\t\t\t\turl = url.substring(0, frag === -1 ? undefined : frag);\n\t\t\t\t\t\tif (!url) return client.url;\n\n\t\t\t\t\t\treturn new URL(url, client.url.origin);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn client.url;\n\t\t\t},\n\t\t};\n\n\t\tglobal[SCRAMJETCLIENT] = this;\n\t}\n\n\tget frame(): ScramjetFrame | null {\n\t\tif (!iswindow) return null;\n\t\tconst frame = this.descriptors.get(\"window.frameElement\", this.global);\n\n\t\tif (!frame) return null; // we're top level\n\t\tconst sframe = frame[SCRAMJETFRAME];\n\n\t\tif (!sframe) {\n\t\t\t// we're in a subframe, recurse upward until we find one\n\t\t\tlet currentwin = this.global.window;\n\t\t\twhile (currentwin.parent !== currentwin) {\n\t\t\t\tif (!currentwin.frameElement) return null; // ??\n\t\t\t\tif (currentwin.frameElement && currentwin.frameElement[SCRAMJETFRAME]) {\n\t\t\t\t\treturn currentwin.frameElement[SCRAMJETFRAME];\n\t\t\t\t}\n\t\t\t\tcurrentwin = currentwin.parent.window;\n\t\t\t}\n\t\t}\n\n\t\treturn sframe;\n\t}\n\tget isSubframe(): boolean {\n\t\tif (!iswindow) return false;\n\t\tconst frame = this.descriptors.get(\"window.frameElement\", this.global);\n\n\t\tif (!frame) return false; // we're top level\n\t\tconst sframe = frame[SCRAMJETFRAME];\n\t\tif (!sframe) return true;\n\n\t\treturn false;\n\t}\n\tloadcookies(cookiestr: string) {\n\t\tthis.cookieStore.load(cookiestr);\n\t}\n\n\thook() {\n\t\t// @ts-ignore\n\t\tconst context = import.meta.webpackContext(\".\", {\n\t\t\trecursive: true,\n\t\t});\n\n\t\tconst modules: ScramjetModule[] = [];\n\n\t\tfor (const key of context.keys()) {\n\t\t\tconst module: ScramjetModule = context(key);\n\t\t\tif (!key.endsWith(\".ts\")) continue;\n\t\t\tif (\n\t\t\t\t(key.startsWith(\"./dom/\") && \"window\" in this.global) ||\n\t\t\t\t(key.startsWith(\"./worker/\") && \"WorkerGlobalScope\" in this.global) ||\n\t\t\t\tkey.startsWith(\"./shared/\")\n\t\t\t) {\n\t\t\t\tmodules.push(module);\n\t\t\t}\n\t\t}\n\n\t\tmodules.sort((a, b) => {\n\t\t\tconst aorder = a.order || 0;\n\t\t\tconst border = b.order || 0;\n\n\t\t\treturn aorder - border;\n\t\t});\n\n\t\tfor (const module of modules) {\n\t\t\tif (!module.enabled || module.enabled(this))\n\t\t\t\tmodule.default(this, this.global);\n\t\t\telse if (module.disabled) module.disabled(this, this.global);\n\t\t}\n\t}\n\n\tget url(): URL {\n\t\treturn new URL(unrewriteUrl(this.global.location.href));\n\t}\n\n\tset url(url: URL | string) {\n\t\tif (url instanceof URL) url = url.toString();\n\n\t\tconst ev = new NavigateEvent(url);\n\t\tif (this.frame) {\n\t\t\tthis.frame.dispatchEvent(ev);\n\t\t}\n\t\tif (ev.defaultPrevented) return;\n\n\t\tthis.global.location.href = rewriteUrl(ev.url, this.meta);\n\t}\n\n\t// below are the utilities for proxying and trapping dom APIs\n\t// you don't have to understand this it just makes the rest easier\n\t// i'll document it eventually\n\n\tProxy(name: string | string[], handler: Proxy) {\n\t\tif (Array.isArray(name)) {\n\t\t\tfor (const n of name) {\n\t\t\t\tthis.Proxy(n, handler);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst split = name.split(\".\");\n\t\tconst prop = split.pop();\n\t\tconst target = split.reduce((a, b) => a?.[b], this.global);\n\t\tif (!target) return;\n\n\t\tconst original = Reflect.get(target, prop);\n\t\tthis.natives.store[name] = original;\n\n\t\tthis.RawProxy(target, prop, handler);\n\t}\n\tRawProxy(target: any, prop: string, handler: Proxy) {\n\t\tif (!target) return;\n\t\tif (!prop) return;\n\t\tif (!Reflect.has(target, prop)) return;\n\n\t\tconst value = Reflect.get(target, prop);\n\t\tdelete target[prop];\n\n\t\tconst h: ProxyHandler<any> = {};\n\n\t\tif (handler.construct) {\n\t\t\th.construct = function (\n\t\t\t\tconstructor: any,\n\t\t\t\targs: any[],\n\t\t\t\tnewTarget: AnyFunction\n\t\t\t) {\n\t\t\t\tlet returnValue: any = undefined;\n\t\t\t\tlet earlyreturn = false;\n\n\t\t\t\tconst ctx: ProxyCtx = {\n\t\t\t\t\tfn: constructor,\n\t\t\t\t\tthis: null,\n\t\t\t\t\targs,\n\t\t\t\t\tnewTarget: newTarget,\n\t\t\t\t\treturn: (r: any) => {\n\t\t\t\t\t\tearlyreturn = true;\n\t\t\t\t\t\treturnValue = r;\n\t\t\t\t\t},\n\t\t\t\t\tcall: () => {\n\t\t\t\t\t\tearlyreturn = true;\n\t\t\t\t\t\treturnValue = Reflect.construct(ctx.fn, ctx.args, ctx.newTarget);\n\n\t\t\t\t\t\treturn returnValue;\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\thandler.construct(ctx);\n\n\t\t\t\tif (earlyreturn) {\n\t\t\t\t\treturn returnValue;\n\t\t\t\t}\n\n\t\t\t\treturn Reflect.construct(ctx.fn, ctx.args, ctx.newTarget);\n\t\t\t};\n\t\t}\n\n\t\tif (handler.apply) {\n\t\t\th.apply = function (fn: any, that: any, args: any[]) {\n\t\t\t\tlet returnValue: any = undefined;\n\t\t\t\tlet earlyreturn = false;\n\n\t\t\t\tconst ctx: ProxyCtx = {\n\t\t\t\t\tfn,\n\t\t\t\t\tthis: that,\n\t\t\t\t\targs,\n\t\t\t\t\tnewTarget: null,\n\t\t\t\t\treturn: (r: any) => {\n\t\t\t\t\t\tearlyreturn = true;\n\t\t\t\t\t\treturnValue = r;\n\t\t\t\t\t},\n\t\t\t\t\tcall: () => {\n\t\t\t\t\t\tearlyreturn = true;\n\t\t\t\t\t\treturnValue = Reflect.apply(ctx.fn, ctx.this, ctx.args);\n\n\t\t\t\t\t\treturn returnValue;\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tconst pst = Error.prepareStackTrace;\n\n\t\t\t\tError.prepareStackTrace = function (err, s) {\n\t\t\t\t\tif (\n\t\t\t\t\t\ts[0].getFileName() &&\n\t\t\t\t\t\t!s[0].getFileName().startsWith(location.origin + config.prefix)\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn { stack: err.stack };\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\ttry {\n\t\t\t\t\thandler.apply(ctx);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tif (err instanceof Error) {\n\t\t\t\t\t\tif ((err.stack as any) instanceof Object) {\n\t\t\t\t\t\t\t//@ts-expect-error i'm not going to explain this\n\t\t\t\t\t\t\terr.stack = err.stack.stack;\n\t\t\t\t\t\t\tconsole.error(\"ERROR FROM SCRAMJET INTERNALS\", err);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow err;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow err;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tError.prepareStackTrace = pst;\n\n\t\t\t\tif (earlyreturn) {\n\t\t\t\t\treturn returnValue;\n\t\t\t\t}\n\n\t\t\t\treturn Reflect.apply(ctx.fn, ctx.this, ctx.args);\n\t\t\t};\n\t\t}\n\n\t\th.getOwnPropertyDescriptor = getOwnPropertyDescriptorHandler;\n\t\ttarget[prop] = new Proxy(value, h);\n\t}\n\tTrap<T>(name: string | string[], descriptor: Trap<T>): PropertyDescriptor {\n\t\tif (Array.isArray(name)) {\n\t\t\tfor (const n of name) {\n\t\t\t\tthis.Trap(n, descriptor);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst split = name.split(\".\");\n\t\tconst prop = split.pop();\n\t\tconst target = split.reduce((a, b) => a?.[b], this.global);\n\t\tif (!target) return;\n\n\t\tconst original = nativeGetOwnPropertyDescriptor(target, prop);\n\t\tthis.descriptors.store[name] = original;\n\n\t\treturn this.RawTrap(target, prop, descriptor);\n\t}\n\tRawTrap<T>(\n\t\ttarget: any,\n\t\tprop: string,\n\t\tdescriptor: Trap<T>\n\t): PropertyDescriptor {\n\t\tif (!target) return;\n\t\tif (!prop) return;\n\t\tif (!Reflect.has(target, prop)) return;\n\n\t\tconst oldDescriptor = nativeGetOwnPropertyDescriptor(target, prop);\n\n\t\tconst ctx: TrapCtx<T> = {\n\t\t\tthis: null,\n\t\t\tget: function () {\n\t\t\t\treturn oldDescriptor && oldDescriptor.get.call(this.this);\n\t\t\t},\n\t\t\tset: function (v: T) {\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unused-expressions\n\t\t\t\toldDescriptor && oldDescriptor.set.call(this.this, v);\n\t\t\t},\n\t\t};\n\n\t\tdelete target[prop];\n\n\t\tconst desc: PropertyDescriptor = {};\n\n\t\tif (descriptor.get) {\n\t\t\tdesc.get = function () {\n\t\t\t\tctx.this = this;\n\n\t\t\t\treturn descriptor.get(ctx);\n\t\t\t};\n\t\t} else if (oldDescriptor?.get) {\n\t\t\tdesc.get = oldDescriptor.get;\n\t\t}\n\n\t\tif (descriptor.set) {\n\t\t\tdesc.set = function (v: T) {\n\t\t\t\tctx.this = this;\n\n\t\t\t\tdescriptor.set(ctx, v);\n\t\t\t};\n\t\t} else if (oldDescriptor?.set) {\n\t\t\tdesc.set = oldDescriptor.set;\n\t\t}\n\n\t\tif (descriptor.enumerable) desc.enumerable = descriptor.enumerable;\n\t\telse if (oldDescriptor?.enumerable)\n\t\t\tdesc.enumerable = oldDescriptor.enumerable;\n\t\tif (descriptor.configurable) desc.configurable = descriptor.configurable;\n\t\telse if (oldDescriptor?.configurable)\n\t\t\tdesc.configurable = oldDescriptor.configurable;\n\n\t\tObject.defineProperty(target, prop, desc);\n\n\t\treturn oldDescriptor;\n\t}\n}\n","import { rewriteUrl } from \"../shared\";\nimport { ScramjetClient } from \"./client\";\nimport { getOwnPropertyDescriptorHandler } from \"./helpers\";\n\nexport function createDocumentProxy(\n\tclient: ScramjetClient,\n\tself: typeof globalThis\n) {\n\treturn new Proxy(self.document, {\n\t\tget(target, prop) {\n\t\t\tif (prop === \"location\") {\n\t\t\t\treturn client.locationProxy;\n\t\t\t}\n\n\t\t\tif (prop === \"defaultView\") {\n\t\t\t\treturn client.globalProxy;\n\t\t\t}\n\n\t\t\tconst value = Reflect.get(target, prop);\n\n\t\t\treturn value;\n\t\t},\n\t\tset(target, prop, newValue) {\n\t\t\tif (prop === \"location\") {\n\t\t\t\tlocation.href = rewriteUrl(newValue, client.meta);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn Reflect.set(target, prop, newValue);\n\t\t},\n\t\tgetOwnPropertyDescriptor: getOwnPropertyDescriptorHandler,\n\t});\n}\n","import { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, _self: typeof window) {\n\tclient.Trap(\"Element.prototype.attributes\", {\n\t\tget(ctx) {\n\t\t\tconst map = ctx.get() as NamedNodeMap;\n\t\t\tconst proxy = new Proxy(map, {\n\t\t\t\tget(target, prop, _receiver) {\n\t\t\t\t\tconst value = Reflect.get(target, prop);\n\n\t\t\t\t\tif (prop === \"length\") {\n\t\t\t\t\t\treturn Object.keys(proxy).length;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (prop === \"getNamedItem\") {\n\t\t\t\t\t\treturn (name: string) => proxy[name];\n\t\t\t\t\t}\n\t\t\t\t\tif (prop === \"getNamedItemNS\") {\n\t\t\t\t\t\treturn (namespace: string, name: string) =>\n\t\t\t\t\t\t\tproxy[`${namespace}:${name}`];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (prop in NamedNodeMap.prototype && typeof value === \"function\") {\n\t\t\t\t\t\treturn new Proxy(value, {\n\t\t\t\t\t\t\tapply(target, that, args) {\n\t\t\t\t\t\t\t\tif (that === proxy) {\n\t\t\t\t\t\t\t\t\treturn Reflect.apply(target, map, args);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn Reflect.apply(target, that, args);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\t(typeof prop === \"string\" || typeof prop === \"number\") &&\n\t\t\t\t\t\t!isNaN(Number(prop))\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst position = Object.keys(proxy)[prop];\n\n\t\t\t\t\t\treturn map[position];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.has(target, prop)) return undefined;\n\n\t\t\t\t\treturn value;\n\t\t\t\t},\n\t\t\t\townKeys(target) {\n\t\t\t\t\tconst keys = Reflect.ownKeys(target);\n\n\t\t\t\t\treturn keys.filter((key) => this.has(target, key));\n\t\t\t\t},\n\t\t\t\thas(target, prop) {\n\t\t\t\t\tif (typeof prop === \"symbol\") return Reflect.has(target, prop);\n\t\t\t\t\tif (prop.startsWith(\"scramjet-attr-\")) return false;\n\t\t\t\t\tif (map[prop]?.name?.startsWith(\"scramjet-attr-\")) return false;\n\n\t\t\t\t\treturn Reflect.has(target, prop);\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn proxy;\n\t\t},\n\t});\n\n\tclient.Trap(\"Attr.prototype.value\", {\n\t\tget(ctx) {\n\t\t\tif (ctx.this?.ownerElement) {\n\t\t\t\treturn ctx.this.ownerElement.getAttribute(ctx.this.name);\n\t\t\t}\n\n\t\t\treturn ctx.get();\n\t\t},\n\t\tset(ctx, value) {\n\t\t\tif (ctx.this?.ownerElement) {\n\t\t\t\treturn ctx.this.ownerElement.setAttribute(ctx.this.name, value);\n\t\t\t}\n\n\t\t\treturn ctx.set(value);\n\t\t},\n\t});\n}\n","import { rewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tclient.Proxy(\"Navigator.prototype.sendBeacon\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t},\n\t});\n}\n","import type { MessageC2W, MessageW2C } from \"../../worker\";\nimport { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, self: typeof window) {\n\tclient.serviceWorker.addEventListener(\n\t\t\"message\",\n\t\t({ data }: { data: MessageW2C }) => {\n\t\t\tif (!(\"scramjet$type\" in data)) return;\n\n\t\t\tif (data.scramjet$type === \"cookie\") {\n\t\t\t\tclient.cookieStore.setCookies([data.cookie], new URL(data.url));\n\t\t\t\tlet msg = {\n\t\t\t\t\tscramjet$token: data.scramjet$token,\n\t\t\t\t\tscramjet$type: \"cookie\",\n\t\t\t\t};\n\t\t\t\tclient.serviceWorker.controller.postMessage(msg);\n\t\t\t}\n\t\t}\n\t);\n\n\tclient.Trap(\"Document.prototype.cookie\", {\n\t\tget() {\n\t\t\treturn client.cookieStore.getCookies(client.url, true);\n\t\t},\n\t\tset(ctx, value: string) {\n\t\t\tclient.cookieStore.setCookies([value], client.url);\n\t\t\tconst controller = client.descriptors.get(\n\t\t\t\t\"ServiceWorkerContainer.prototype.controller\",\n\t\t\t\tclient.serviceWorker\n\t\t\t);\n\t\t\tif (controller) {\n\t\t\t\tclient.natives.call(\"ServiceWorker.prototype.postMessage\", controller, {\n\t\t\t\t\tscramjet$type: \"cookie\",\n\t\t\t\t\tcookie: value,\n\t\t\t\t\turl: client.url.href,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t});\n\n\t// @ts-ignore\n\tdelete self.cookieStore;\n}\n","import { ScramjetClient } from \"../client\";\nimport { rewriteCss, unrewriteCss } from \"../../shared\";\n\nexport default function (client: ScramjetClient) {\n\tclient.Proxy(\"CSSStyleDeclaration.prototype.setProperty\", {\n\t\tapply(ctx) {\n\t\t\tif (!ctx.args[1]) return;\n\t\t\tctx.args[1] = rewriteCss(ctx.args[1], client.meta);\n\t\t},\n\t});\n\n\tclient.Proxy(\"CSSStyleDeclaration.prototype.getPropertyValue\", {\n\t\tapply(ctx) {\n\t\t\tconst v = ctx.call();\n\t\t\tif (!v) return v;\n\t\t\tctx.return(unrewriteCss(v));\n\t\t},\n\t});\n\n\tclient.Trap(\"CSSStyleDeclaration.prototype.cssText\", {\n\t\tset(ctx, value: string) {\n\t\t\tctx.set(rewriteCss(value, client.meta));\n\t\t},\n\t\tget(ctx) {\n\t\t\treturn unrewriteCss(ctx.get());\n\t\t},\n\t});\n\n\tclient.Trap(\"HTMLElement.prototype.style\", {\n\t\tget(ctx) {\n\t\t\t// unfortunate and dumb hack. we have to trap every property of this\n\t\t\t// since the prototype chain is fucked\n\n\t\t\tconst style = ctx.get() as CSSStyleDeclaration;\n\n\t\t\treturn new Proxy(style, {\n\t\t\t\tget(t, p) {\n\t\t\t\t\tconst v = Reflect.get(t, p);\n\n\t\t\t\t\tif (typeof v === \"function\") {\n\t\t\t\t\t\treturn new Proxy(v, {\n\t\t\t\t\t\t\tapply(target, that, args) {\n\t\t\t\t\t\t\t\treturn Reflect.apply(target, style, args);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (p in CSSStyleDeclaration.prototype) return v;\n\t\t\t\t\tif (!v) return v;\n\n\t\t\t\t\treturn unrewriteCss(v);\n\t\t\t\t},\n\t\t\t\tset(t, p, v) {\n\t\t\t\t\tif (p == \"cssText\" || v == \"\" || typeof v !== \"string\") {\n\t\t\t\t\t\treturn Reflect.set(t, p, v);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Reflect.set(t, p, rewriteCss(v, client.meta));\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\tset(ctx, v: string) {\n\t\t\t// this will actually run the trap for cssText. don't rewrite it here\n\t\t\tctx.set(v);\n\t\t},\n\t});\n}\n","import { rewriteHtml } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tclient.Proxy(\"Document.prototype.write\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0])\n\t\t\t\ttry {\n\t\t\t\t\tctx.args[0] = rewriteHtml(\n\t\t\t\t\t\tctx.args[0],\n\t\t\t\t\t\tclient.cookieStore,\n\t\t\t\t\t\tclient.meta,\n\t\t\t\t\t\tfalse\n\t\t\t\t\t);\n\t\t\t\t} catch {}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Document.prototype.writeln\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0])\n\t\t\t\ttry {\n\t\t\t\t\tctx.args[0] = rewriteHtml(\n\t\t\t\t\t\tctx.args[0],\n\t\t\t\t\t\tclient.cookieStore,\n\t\t\t\t\t\tclient.meta,\n\t\t\t\t\t\tfalse\n\t\t\t\t\t);\n\t\t\t\t} catch {}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Document.prototype.parseHTMLUnsafe\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0])\n\t\t\t\ttry {\n\t\t\t\t\tctx.args[0] = rewriteHtml(\n\t\t\t\t\t\tctx.args[0],\n\t\t\t\t\t\tclient.cookieStore,\n\t\t\t\t\t\tclient.meta,\n\t\t\t\t\t\tfalse\n\t\t\t\t\t);\n\t\t\t\t} catch {}\n\t\t},\n\t});\n}\n","import { SCRAMJETCLIENT } from \"../../symbols\";\nimport { ScramjetClient } from \"../client\";\nimport { nativeGetOwnPropertyDescriptor } from \"../natives\";\nimport { unrewriteUrl, htmlRules, unrewriteHtml } from \"../../shared\";\nimport { rewriteCss, rewriteHtml, rewriteJs } from \"../../shared\";\n\nconst encoder = new TextEncoder();\nfunction bytesToBase64(bytes: Uint8Array) {\n\tconst binString = Array.from(bytes, (byte) =>\n\t\tString.fromCodePoint(byte)\n\t).join(\"\");\n\n\treturn btoa(binString);\n}\nexport default function (client: ScramjetClient, self: typeof window) {\n\tconst attrObject = {\n\t\tnonce: [self.HTMLElement],\n\t\tintegrity: [self.HTMLScriptElement, self.HTMLLinkElement],\n\t\tcsp: [self.HTMLIFrameElement],\n\t\tcredentialless: [self.HTMLIFrameElement],\n\t\tsrc: [\n\t\t\tself.HTMLImageElement,\n\t\t\tself.HTMLMediaElement,\n\t\t\tself.HTMLIFrameElement,\n\t\t\tself.HTMLFrameElement,\n\t\t\tself.HTMLEmbedElement,\n\t\t\tself.HTMLScriptElement,\n\t\t\tself.HTMLSourceElement,\n\t\t],\n\t\thref: [self.HTMLAnchorElement, self.HTMLLinkElement, self.SVGImageElement],\n\t\tdata: [self.HTMLObjectElement],\n\t\taction: [self.HTMLFormElement],\n\t\tformaction: [self.HTMLButtonElement, self.HTMLInputElement],\n\t\tsrcdoc: [self.HTMLIFrameElement],\n\t\tsrcset: [self.HTMLImageElement, self.HTMLSourceElement],\n\t\tposter: [self.HTMLVideoElement],\n\t\timagesrcset: [self.HTMLLinkElement],\n\t};\n\n\tconst urlinterfaces = [\n\t\tself.HTMLAnchorElement.prototype,\n\t\tself.HTMLAreaElement.prototype,\n\t];\n\tconst originalhrefs = [\n\t\tnativeGetOwnPropertyDescriptor(self.HTMLAnchorElement.prototype, \"href\"),\n\t\tnativeGetOwnPropertyDescriptor(self.HTMLAreaElement.prototype, \"href\"),\n\t];\n\n\tconst attrs = Object.keys(attrObject);\n\n\tfor (const attr of attrs) {\n\t\tfor (const element of attrObject[attr]) {\n\t\t\tconst descriptor = nativeGetOwnPropertyDescriptor(\n\t\t\t\telement.prototype,\n\t\t\t\tattr\n\t\t\t);\n\t\t\tObject.defineProperty(element.prototype, attr, {\n\t\t\t\tget() {\n\t\t\t\t\tif ([\"src\", \"data\", \"href\", \"action\", \"formaction\"].includes(attr)) {\n\t\t\t\t\t\treturn unrewriteUrl(descriptor.get.call(this));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn descriptor.get.call(this);\n\t\t\t\t},\n\n\t\t\t\tset(value) {\n\t\t\t\t\treturn this.setAttribute(attr, value);\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\t// note that href is not here\n\tconst urlprops = [\n\t\t\"protocol\",\n\t\t\"hash\",\n\t\t\"host\",\n\t\t\"hostname\",\n\t\t\"origin\",\n\t\t\"pathname\",\n\t\t\"port\",\n\t\t\"search\",\n\t];\n\tfor (const prop of urlprops) {\n\t\tfor (const i in urlinterfaces) {\n\t\t\tconst target = urlinterfaces[i];\n\t\t\tconst desc = originalhrefs[i];\n\t\t\tclient.RawTrap(target, prop, {\n\t\t\t\tget(ctx) {\n\t\t\t\t\tconst href = desc.get.call(ctx.this);\n\t\t\t\t\tif (!href) return href;\n\n\t\t\t\t\tconst url = new URL(unrewriteUrl(href));\n\n\t\t\t\t\treturn url[prop];\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\tclient.Trap(\"Node.prototype.baseURI\", {\n\t\tget(ctx) {\n\t\t\tconst node = ctx.this as Node;\n\t\t\tlet base = node.ownerDocument?.querySelector(\"base\");\n\t\t\tif (node instanceof Document) base = node.querySelector(\"base\");\n\n\t\t\tif (base) {\n\t\t\t\treturn new URL(base.href, client.url.origin).href;\n\t\t\t}\n\n\t\t\treturn client.url.origin;\n\t\t},\n\t\tset(ctx, v) {\n\t\t\treturn false;\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.getAttribute\", {\n\t\tapply(ctx) {\n\t\t\tconst [name] = ctx.args;\n\n\t\t\tif (name.startsWith(\"scramjet-attr\")) {\n\t\t\t\treturn ctx.return(null);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tclient.natives.call(\n\t\t\t\t\t\"Element.prototype.hasAttribute\",\n\t\t\t\t\tctx.this,\n\t\t\t\t\t`scramjet-attr-${name}`\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tconst attrib = ctx.fn.call(ctx.this, `scramjet-attr-${name}`);\n\t\t\t\tif (attrib === null) return ctx.return(\"\");\n\n\t\t\t\treturn ctx.return(attrib);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.getAttributeNames\", {\n\t\tapply(ctx) {\n\t\t\tconst attrNames = ctx.call() as string[];\n\t\t\tconst cleaned = attrNames.filter(\n\t\t\t\t(attr) => !attr.startsWith(\"scramjet-attr\")\n\t\t\t);\n\n\t\t\tctx.return(cleaned);\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.getAttributeNode\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0].startsWith(\"scramjet-attr\")) return ctx.return(null);\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.hasAttribute\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0].startsWith(\"scramjet-attr\")) return ctx.return(false);\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.setAttribute\", {\n\t\tapply(ctx) {\n\t\t\tconst [name, value] = ctx.args;\n\n\t\t\tconst ruleList = htmlRules.find((rule) => {\n\t\t\t\tconst r = rule[name.toLowerCase()];\n\t\t\t\tif (!r) return false;\n\t\t\t\tif (r === \"*\") return true;\n\t\t\t\tif (typeof r === \"function\") return false; // this can't happen but ts\n\n\t\t\t\treturn r.includes(ctx.this.tagName.toLowerCase());\n\t\t\t});\n\n\t\t\tif (ruleList) {\n\t\t\t\tctx.args[1] = ruleList.fn(value, client.meta, client.cookieStore);\n\t\t\t\tctx.fn.call(ctx.this, `scramjet-attr-${ctx.args[0]}`, value);\n\t\t\t}\n\t\t},\n\t});\n\n\t// i actually need to do something with this\n\tclient.Proxy(\"Element.prototype.setAttributeNode\", {\n\t\tapply(_ctx) {},\n\t});\n\n\tclient.Proxy(\"Element.prototype.setAttributeNS\", {\n\t\tapply(ctx) {\n\t\t\tconst [_namespace, name, value] = ctx.args;\n\n\t\t\tconst ruleList = htmlRules.find((rule) => {\n\t\t\t\tconst r = rule[name.toLowerCase()];\n\t\t\t\tif (!r) return false;\n\t\t\t\tif (r === \"*\") return true;\n\t\t\t\tif (typeof r === \"function\") return false; // this can't happen but ts\n\n\t\t\t\treturn r.includes(ctx.this.tagName.toLowerCase());\n\t\t\t});\n\n\t\t\tif (ruleList) {\n\t\t\t\tctx.args[2] = ruleList.fn(value, client.meta, client.cookieStore);\n\t\t\t\tclient.natives.call(\n\t\t\t\t\t\"Element.prototype.setAttribute\",\n\t\t\t\t\tctx.this,\n\t\t\t\t\t`scramjet-attr-${ctx.args[1]}`,\n\t\t\t\t\tvalue\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.removeAttribute\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0].startsWith(\"scramjet-attr\")) return ctx.return(undefined);\n\t\t\tif (\n\t\t\t\tclient.natives.call(\n\t\t\t\t\t\"Element.prototype.hasAttribute\",\n\t\t\t\t\tctx.this,\n\t\t\t\t\tctx.args[0]\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tctx.fn.call(ctx.this, `scramjet-attr-${ctx.args[0]}`);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.toggleAttribute\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0].startsWith(\"scramjet-attr\")) return ctx.return(false);\n\t\t\tif (\n\t\t\t\tclient.natives.call(\n\t\t\t\t\t\"Element.prototype.hasAttribute\",\n\t\t\t\t\tctx.this,\n\t\t\t\t\tctx.args[0]\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tctx.fn.call(ctx.this, `scramjet-attr-${ctx.args[0]}`);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Trap(\"Element.prototype.innerHTML\", {\n\t\tset(ctx, value: string) {\n\t\t\tlet newval;\n\t\t\tif (ctx.this instanceof self.HTMLScriptElement) {\n\t\t\t\tnewval = rewriteJs(value, \"(anonymous script element)\", client.meta);\n\t\t\t\tclient.natives.call(\n\t\t\t\t\t\"Element.prototype.setAttribute\",\n\t\t\t\t\tctx.this,\n\t\t\t\t\t\"scramjet-attr-script-source-src\",\n\t\t\t\t\tbytesToBase64(encoder.encode(newval))\n\t\t\t\t);\n\t\t\t} else if (ctx.this instanceof self.HTMLStyleElement) {\n\t\t\t\tnewval = rewriteCss(value, client.meta);\n\t\t\t} else {\n\t\t\t\ttry {\n\t\t\t\t\tnewval = rewriteHtml(value, client.cookieStore, client.meta);\n\t\t\t\t} catch {\n\t\t\t\t\tnewval = value;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tctx.set(newval);\n\t\t},\n\t\tget(ctx) {\n\t\t\tif (ctx.this instanceof self.HTMLScriptElement) {\n\t\t\t\tconst scriptSource = client.natives.call(\n\t\t\t\t\t\"Element.prototype.getAttribute\",\n\t\t\t\t\tctx.this,\n\t\t\t\t\t\"scramjet-attr-script-source-src\"\n\t\t\t\t);\n\n\t\t\t\tif (scriptSource) {\n\t\t\t\t\treturn atob(scriptSource);\n\t\t\t\t}\n\n\t\t\t\treturn ctx.get();\n\t\t\t}\n\t\t\tif (ctx.this instanceof self.HTMLStyleElement) {\n\t\t\t\treturn ctx.get();\n\t\t\t}\n\n\t\t\treturn unrewriteHtml(ctx.get());\n\t\t},\n\t});\n\n\tclient.Trap(\"Element.prototype.outerHTML\", {\n\t\tset(ctx, value: string) {\n\t\t\tctx.set(rewriteHtml(value, client.cookieStore, client.meta));\n\t\t},\n\t\tget(ctx) {\n\t\t\treturn unrewriteHtml(ctx.get());\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.setHTMLUnsafe\", {\n\t\tapply(ctx) {\n\t\t\ttry {\n\t\t\t\tctx.args[0] = rewriteHtml(\n\t\t\t\t\tctx.args[0],\n\t\t\t\t\tclient.cookieStore,\n\t\t\t\t\tclient.meta,\n\t\t\t\t\tfalse\n\t\t\t\t);\n\t\t\t} catch {}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.getHTML\", {\n\t\tapply(ctx) {\n\t\t\tctx.return(unrewriteHtml(ctx.call()));\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.insertAdjacentHTML\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[1])\n\t\t\t\ttry {\n\t\t\t\t\tctx.args[1] = rewriteHtml(\n\t\t\t\t\t\tctx.args[1],\n\t\t\t\t\t\tclient.cookieStore,\n\t\t\t\t\t\tclient.meta,\n\t\t\t\t\t\tfalse\n\t\t\t\t\t);\n\t\t\t\t} catch {}\n\t\t},\n\t});\n\n\tclient.Trap(\n\t\t[\n\t\t\t\"HTMLIFrameElement.prototype.contentWindow\",\n\t\t\t\"HTMLFrameElement.prototype.contentWindow\",\n\t\t\t\"HTMLObjectElement.prototype.contentWindow\",\n\t\t\t\"HTMLEmbedElement.prototype.contentWindow\",\n\t\t],\n\t\t{\n\t\t\tget(ctx) {\n\t\t\t\tconst realwin = ctx.get() as Window;\n\t\t\t\tif (!realwin) return realwin;\n\n\t\t\t\tif (SCRAMJETCLIENT in realwin) {\n\t\t\t\t\treturn realwin[SCRAMJETCLIENT].globalProxy;\n\t\t\t\t} else {\n\t\t\t\t\t// hook the iframe\n\t\t\t\t\tconst newclient = new ScramjetClient(realwin);\n\t\t\t\t\tnewclient.hook();\n\n\t\t\t\t\treturn newclient.globalProxy;\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t);\n\n\tclient.Trap(\n\t\t[\n\t\t\t\"HTMLIFrameElement.prototype.contentDocument\",\n\t\t\t\"HTMLFrameElement.prototype.contentDocument\",\n\t\t\t\"HTMLObjectElement.prototype.contentDocument\",\n\t\t\t\"HTMLEmbedElement.prototype.contentDocument\",\n\t\t],\n\t\t{\n\t\t\tget(ctx) {\n\t\t\t\tconst realwin = client.descriptors.get(\n\t\t\t\t\t`${ctx.this.constructor.name}.prototype.contentWindow`,\n\t\t\t\t\tctx.this\n\t\t\t\t);\n\t\t\t\tif (!realwin) return realwin;\n\n\t\t\t\tif (SCRAMJETCLIENT in realwin) {\n\t\t\t\t\treturn realwin[SCRAMJETCLIENT].documentProxy;\n\t\t\t\t} else {\n\t\t\t\t\tconst newclient = new ScramjetClient(realwin);\n\t\t\t\t\tnewclient.hook();\n\n\t\t\t\t\treturn newclient.documentProxy;\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t);\n\n\tclient.Proxy(\n\t\t[\n\t\t\t\"HTMLIFrameElement.prototype.getSVGDocument\",\n\t\t\t\"HTMLObjectElement.prototype.getSVGDocument\",\n\t\t\t\"HTMLEmbedElement.prototype.getSVGDocument\",\n\t\t],\n\t\t{\n\t\t\tapply(ctx) {\n\t\t\t\tconst doc = ctx.call();\n\t\t\t\tif (doc) {\n\t\t\t\t\treturn ctx.return(ctx.this.contentDocument);\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t);\n\n\tclient.Trap(\"TreeWalker.prototype.currentNode\", {\n\t\tget(ctx) {\n\t\t\treturn ctx.get();\n\t\t},\n\t\tset(ctx, value) {\n\t\t\tif (value === client.documentProxy) {\n\t\t\t\treturn ctx.set(self.document);\n\t\t\t}\n\n\t\t\treturn ctx.set(value);\n\t\t},\n\t});\n\n\tclient.Proxy(\"Document.prototype.open\", {\n\t\tapply(ctx) {\n\t\t\tconst doc = ctx.call() as Document;\n\n\t\t\tconst scram: ScramjetClient = doc[SCRAMJETCLIENT];\n\t\t\tif (!scram) return ctx.return(doc); // ??\n\n\t\t\treturn ctx.return(scram.documentProxy);\n\t\t},\n\t});\n\n\tclient.Trap(\"Node.prototype.ownerDocument\", {\n\t\tget(ctx) {\n\t\t\tconst doc = ctx.get() as Document | null;\n\t\t\tif (!doc) return null;\n\n\t\t\tconst scram: ScramjetClient = doc[SCRAMJETCLIENT];\n\t\t\tif (!scram) return doc; // ??\n\n\t\t\treturn scram.documentProxy;\n\t\t},\n\t});\n\n\tclient.Trap(\n\t\t[\n\t\t\t\"Node.prototype.parentNode\",\n\t\t\t\"Node.prototype.parentElement\",\n\t\t\t\"Node.prototype.previousSibling\",\n\t\t\t\"Node.prototype.nextSibling\",\n\t\t\t\"Range.prototype.commonAncestorContainer\",\n\t\t\t\"AbstractRange.prototype.endContainer\",\n\t\t\t\"AbstractRange.prototype.startContainer\",\n\t\t],\n\t\t{\n\t\t\tget(ctx) {\n\t\t\t\tconst n = ctx.get() as Node;\n\t\t\t\tif (!(n instanceof Document)) return n;\n\n\t\t\t\tconst scram: ScramjetClient = n[SCRAMJETCLIENT];\n\t\t\t\tif (!scram) return n; // ??\n\n\t\t\t\treturn scram.documentProxy;\n\t\t\t},\n\t\t}\n\t);\n\n\tclient.Proxy(\"Node.prototype.getRootNode\", {\n\t\tapply(ctx) {\n\t\t\tconst n = ctx.call() as Node;\n\t\t\tif (!(n instanceof Document)) return ctx.return(n);\n\n\t\t\tconst scram: ScramjetClient = n[SCRAMJETCLIENT];\n\t\t\tif (!scram) return ctx.return(n); // ??\n\n\t\t\treturn ctx.return(scram.documentProxy);\n\t\t},\n\t});\n\n\tclient.Proxy(\"DOMParser.prototype.parseFromString\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[1] === \"text/html\") {\n\t\t\t\ttry {\n\t\t\t\t\tctx.args[0] = rewriteHtml(\n\t\t\t\t\t\tctx.args[0],\n\t\t\t\t\t\tclient.cookieStore,\n\t\t\t\t\t\tclient.meta,\n\t\t\t\t\t\tfalse\n\t\t\t\t\t);\n\t\t\t\t} catch {}\n\t\t\t}\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\nimport { rewriteCss } from \"../../shared\";\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tclient.Proxy(\"FontFace\", {\n\t\tconstruct(ctx) {\n\t\t\tctx.args[1] = rewriteCss(ctx.args[1], client.meta);\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\nimport { rewriteUrl } from \"../../shared\";\nimport { UrlChangeEvent } from \"../events\";\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tclient.Proxy(\"History.prototype.pushState\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[2] || ctx.args[2] === \"\")\n\t\t\t\tctx.args[2] = rewriteUrl(ctx.args[2], client.meta);\n\t\t\tctx.call();\n\n\t\t\tconst ev = new UrlChangeEvent(client.url.href);\n\t\t\tif (!client.isSubframe) client.frame?.dispatchEvent(ev);\n\t\t},\n\t});\n\n\tclient.Proxy(\"History.prototype.replaceState\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[2] || ctx.args[2] === \"\")\n\t\t\t\tctx.args[2] = rewriteUrl(ctx.args[2], client.meta);\n\t\t\tctx.call();\n\n\t\t\tconst ev = new UrlChangeEvent(client.url.href);\n\t\t\tif (!client.isSubframe) client.frame?.dispatchEvent(ev);\n\t\t},\n\t});\n}\n","export default function (client, self: Self) {\n\t// @ts-ignore\n\tdelete self.navigation;\n}\n","import { rewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\nimport { SCRAMJETCLIENT } from \"../../symbols\";\n\nexport default function (client: ScramjetClient) {\n\tclient.Proxy(\"window.open\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0]) ctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\n\t\t\tif ([\"_parent\", \"_top\", \"_unfencedTop\"].includes(ctx.args[1]))\n\t\t\t\tctx.args[1] = \"_self\";\n\n\t\t\tconst realwin = ctx.call();\n\n\t\t\tif (!realwin) return ctx.return(realwin);\n\n\t\t\tif (SCRAMJETCLIENT in realwin) {\n\t\t\t\treturn ctx.return(realwin[SCRAMJETCLIENT].globalProxy);\n\t\t\t} else {\n\t\t\t\tconst newclient = new ScramjetClient(realwin);\n\t\t\t\t// hook the opened window\n\t\t\t\tnewclient.hook();\n\n\t\t\t\treturn ctx.return(newclient.globalProxy);\n\t\t\t}\n\t\t},\n\t});\n\n\t// opener will refer to the real window if it was opened by window.open\n\tclient.Trap(\"opener\", {\n\t\tget(ctx) {\n\t\t\tconst realwin = ctx.get() as Window;\n\n\t\t\tif (realwin && SCRAMJETCLIENT in realwin) {\n\t\t\t\treturn realwin[SCRAMJETCLIENT].globalProxy;\n\t\t\t} else {\n\t\t\t\t// the opener has to have been already hooked, so if we reach here then it's a real window\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Trap(\"window.frameElement\", {\n\t\tget(ctx) {\n\t\t\tconst f = ctx.get() as HTMLIFrameElement | null;\n\t\t\tif (!f) return f;\n\n\t\t\tconst win = f.ownerDocument.defaultView;\n\t\t\tif (win[SCRAMJETCLIENT]) {\n\t\t\t\t// then this is a subframe in a scramjet context, and it's safe to pass back the real iframe\n\t\t\t\treturn f;\n\t\t\t} else {\n\t\t\t\t// no, the top frame is outside the sandbox\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tclient.Trap(\"origin\", {\n\t\tget() {\n\t\t\t// this isn't right!!\n\t\t\treturn client.url.origin;\n\t\t},\n\t\tset() {\n\t\t\treturn false;\n\t\t},\n\t});\n\n\tclient.Trap(\"Document.prototype.URL\", {\n\t\tget() {\n\t\t\treturn client.url.href;\n\t\t},\n\t\tset() {\n\t\t\treturn false;\n\t\t},\n\t});\n\n\tclient.Trap(\"Document.prototype.documentURI\", {\n\t\tget() {\n\t\t\treturn client.url.href;\n\t\t},\n\t\tset() {\n\t\t\treturn false;\n\t\t},\n\t});\n\n\tclient.Trap(\"Document.prototype.domain\", {\n\t\tget() {\n\t\t\treturn client.url.hostname;\n\t\t},\n\t\tset() {\n\t\t\treturn false;\n\t\t},\n\t});\n}\n","import { unrewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tclient.Trap(\"PerformanceEntry.prototype.name\", {\n\t\tget(ctx) {\n\t\t\treturn unrewriteUrl(ctx.get() as string);\n\t\t},\n\t});\n}\n","import { rewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\nimport { type MessageC2W } from \"../../worker\";\nimport { flagEnabled } from \"../../scramjet\";\n\n// we need a late order because we're mangling with addEventListener at a higher level\nexport const order = 2;\n\nexport const enabled = (client: ScramjetClient) =>\n\tflagEnabled(\"serviceworkers\", client.url);\n\nexport function disabled(_client: ScramjetClient, _self: Self) {\n\tReflect.deleteProperty(Navigator.prototype, \"serviceWorker\");\n}\n\ntype FakeRegistrationState = {\n\tscope: string;\n\tactive: ServiceWorker;\n};\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tconst registrationmap: WeakMap<\n\t\tServiceWorkerRegistration,\n\t\tFakeRegistrationState\n\t> = new WeakMap();\n\tclient.Proxy(\"EventTarget.prototype.addEventListener\", {\n\t\tapply(ctx) {\n\t\t\tif (registrationmap.get(ctx.this)) {\n\t\t\t\t// do nothing\n\t\t\t\tctx.return(undefined);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"EventTarget.prototype.removeEventListener\", {\n\t\tapply(ctx) {\n\t\t\tif (registrationmap.get(ctx.this)) {\n\t\t\t\t// do nothing\n\t\t\t\tctx.return(undefined);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"ServiceWorkerContainer.prototype.getRegistration\", {\n\t\tapply(ctx) {\n\t\t\tctx.return(new Promise((resolve) => resolve(registration)));\n\t\t},\n\t});\n\n\tclient.Proxy(\"ServiceWorkerContainer.prototype.getRegistrations\", {\n\t\tapply(ctx) {\n\t\t\tctx.return(new Promise((resolve) => resolve([registration])));\n\t\t},\n\t});\n\n\tclient.Trap(\"ServiceWorkerContainer.prototype.ready\", {\n\t\tget(_ctx) {\n\t\t\treturn new Promise((resolve) => resolve(registration));\n\t\t},\n\t});\n\n\tclient.Trap(\"ServiceWorkerContainer.prototype.controller\", {\n\t\tget(ctx) {\n\t\t\treturn registration?.active;\n\t\t},\n\t});\n\n\tclient.Proxy(\"ServiceWorkerContainer.prototype.register\", {\n\t\tapply(ctx) {\n\t\t\tconst fakeRegistration = new EventTarget() as ServiceWorkerRegistration;\n\t\t\tObject.setPrototypeOf(\n\t\t\t\tfakeRegistration,\n\t\t\t\tself.ServiceWorkerRegistration.prototype\n\t\t\t);\n\t\t\tfakeRegistration.constructor = ctx.fn;\n\t\t\tlet url = rewriteUrl(ctx.args[0], client.meta) + \"?dest=serviceworker\";\n\t\t\tif (ctx.args[1] && ctx.args[1].type === \"module\") {\n\t\t\t\turl += \"&type=module\";\n\t\t\t}\n\n\t\t\tconst worker = client.natives.construct(\"SharedWorker\", url);\n\t\t\tconst handle = worker.port;\n\t\t\tconst state: FakeRegistrationState = {\n\t\t\t\tscope: ctx.args[0],\n\t\t\t\tactive: handle as ServiceWorker,\n\t\t\t};\n\t\t\tconst controller = client.descriptors.get(\n\t\t\t\t\"ServiceWorkerContainer.prototype.controller\",\n\t\t\t\tclient.serviceWorker\n\t\t\t);\n\n\t\t\tclient.natives.call(\n\t\t\t\t\"ServiceWorker.prototype.postMessage\",\n\t\t\t\tcontroller,\n\t\t\t\t{\n\t\t\t\t\tscramjet$type: \"registerServiceWorker\",\n\t\t\t\t\tport: handle,\n\t\t\t\t\torigin: client.url.origin,\n\t\t\t\t} as MessageC2W,\n\t\t\t\t[handle]\n\t\t\t);\n\n\t\t\tregistrationmap.set(fakeRegistration, state);\n\t\t\tctx.return(new Promise((resolve) => resolve(fakeRegistration)));\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, self: typeof window) {\n\tconst handler: ProxyHandler<Storage> = {\n\t\tget(target, prop) {\n\t\t\tswitch (prop) {\n\t\t\t\tcase \"getItem\":\n\t\t\t\t\treturn (key: string) => {\n\t\t\t\t\t\treturn target.getItem(client.url.host + \"@\" + key);\n\t\t\t\t\t};\n\n\t\t\t\tcase \"setItem\":\n\t\t\t\t\treturn (key: string, value: string) => {\n\t\t\t\t\t\treturn target.setItem(client.url.host + \"@\" + key, value);\n\t\t\t\t\t};\n\n\t\t\t\tcase \"removeItem\":\n\t\t\t\t\treturn (key: string) => {\n\t\t\t\t\t\treturn target.removeItem(client.url.host + \"@\" + key);\n\t\t\t\t\t};\n\n\t\t\t\tcase \"clear\":\n\t\t\t\t\treturn () => {\n\t\t\t\t\t\tfor (const key in Object.keys(target)) {\n\t\t\t\t\t\t\tif (key.startsWith(client.url.host)) {\n\t\t\t\t\t\t\t\ttarget.removeItem(key);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\tcase \"key\":\n\t\t\t\t\treturn (index: number) => {\n\t\t\t\t\t\tconst keys = Object.keys(target).filter((key) =>\n\t\t\t\t\t\t\tkey.startsWith(client.url.host)\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\treturn target.getItem(keys[index]);\n\t\t\t\t\t};\n\n\t\t\t\tcase \"length\":\n\t\t\t\t\treturn Object.keys(target).filter((key) =>\n\t\t\t\t\t\tkey.startsWith(client.url.host)\n\t\t\t\t\t).length;\n\n\t\t\t\tdefault:\n\t\t\t\t\tif (prop in Object.prototype || typeof prop === \"symbol\") {\n\t\t\t\t\t\treturn Reflect.get(target, prop);\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log(\"GET\", prop, target == realLocalStorage);\n\n\t\t\t\t\treturn target.getItem(client.url.host + \"@\" + (prop as string));\n\t\t\t}\n\t\t},\n\n\t\tset(target, prop, value) {\n\t\t\tif (target == realLocalStorage)\n\t\t\t\tconsole.log(\"SET\", prop, value, target === realLocalStorage);\n\t\t\ttarget.setItem(client.url.host + \"@\" + (prop as string), value);\n\n\t\t\treturn true;\n\t\t},\n\n\t\townKeys(target) {\n\t\t\treturn Reflect.ownKeys(target)\n\t\t\t\t.filter((f) => typeof f === \"string\" && f.startsWith(client.url.host))\n\t\t\t\t.map((f) =>\n\t\t\t\t\ttypeof f === \"string\" ? f.substring(client.url.host.length + 1) : f\n\t\t\t\t);\n\t\t},\n\n\t\tgetOwnPropertyDescriptor(target, property) {\n\t\t\treturn {\n\t\t\t\tvalue: target.getItem(client.url.host + \"@\" + (property as string)),\n\t\t\t\tenumerable: true,\n\t\t\t\tconfigurable: true,\n\t\t\t\twritable: true,\n\t\t\t};\n\t\t},\n\n\t\tdefineProperty(target, property, attributes) {\n\t\t\ttarget.setItem(\n\t\t\t\tclient.url.host + \"@\" + (property as string),\n\t\t\t\tattributes.value\n\t\t\t);\n\n\t\t\treturn true;\n\t\t},\n\t};\n\n\tconst realLocalStorage = self.localStorage;\n\n\tconst localStorageProxy = new Proxy(self.localStorage, handler);\n\tconst sessionStorageProxy = new Proxy(self.sessionStorage, handler);\n\n\tdelete self.localStorage;\n\tdelete self.sessionStorage;\n\n\tself.localStorage = localStorageProxy;\n\tself.sessionStorage = sessionStorageProxy;\n}\n","export class NavigateEvent extends Event {\n\tconstructor(public url: string) {\n\t\tsuper(\"navigate\");\n\t}\n}\n\nexport class UrlChangeEvent extends Event {\n\tconstructor(public url: string) {\n\t\tsuper(\"urlchange\");\n\t}\n}\n\nexport class ScramjetContextEvent extends Event {\n\tconstructor(public window: Self) {\n\t\tsuper(\"contextInit\");\n\t}\n}\n","// import { encodeUrl } from \"../shared\";\nimport { iswindow } from \".\";\nimport { SCRAMJETCLIENT } from \"../symbols\";\nimport { ScramjetClient } from \"./client\";\n// import { config } from \"../shared\";\nimport { getOwnPropertyDescriptorHandler } from \"./helpers\";\n\nexport const UNSAFE_GLOBALS = [\n\t\"window\",\n\t\"self\",\n\t\"globalThis\",\n\t\"this\",\n\t\"parent\",\n\t\"top\",\n\t\"location\",\n\t\"document\",\n\t\"eval\",\n\t\"frames\",\n];\n\nexport function createGlobalProxy(\n\tclient: ScramjetClient,\n\tself: typeof globalThis\n): typeof globalThis {\n\treturn new Proxy(self, {\n\t\tget(target, prop) {\n\t\t\tconst value = Reflect.get(target, prop);\n\n\t\t\tif (\n\t\t\t\tiswindow &&\n\t\t\t\t(typeof prop === \"string\" || typeof prop === \"number\") &&\n\t\t\t\t!isNaN(Number(prop)) &&\n\t\t\t\tvalue\n\t\t\t) {\n\t\t\t\tconst win: Self = value.self;\n\t\t\t\t// indexing into window gives you the contentWindow of the subframes for some reason\n\t\t\t\t// you can't *set* it so this should always be the right value\n\t\t\t\tif (win) {\n\t\t\t\t\tif (SCRAMJETCLIENT in win) {\n\t\t\t\t\t\t// then we've already hooked this frame and we can just send over its proxy\n\t\t\t\t\t\treturn win[SCRAMJETCLIENT].globalProxy;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// this can happen if it's an about:blank iframe that we've never gotten the chance to inject into\n\t\t\t\t\t\t// just make a new client for it and inject\n\t\t\t\t\t\tconst newclient = new ScramjetClient(win);\n\t\t\t\t\t\tnewclient.hook();\n\n\t\t\t\t\t\treturn newclient.globalProxy;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (prop === \"$scramjet\") return undefined;\n\n\t\t\tif (typeof prop === \"string\" && UNSAFE_GLOBALS.includes(prop)) {\n\t\t\t\t// TODO strict mode detect\n\t\t\t\treturn client.wrapfn(value, true);\n\t\t\t}\n\n\t\t\treturn value;\n\t\t},\n\n\t\tset(target, prop, value) {\n\t\t\tif (prop === \"location\") {\n\t\t\t\tclient.url = value;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn Reflect.set(target, prop, value);\n\t\t},\n\t\thas(target, prop) {\n\t\t\tif (prop === \"$scramjet\") return false;\n\n\t\t\treturn Reflect.has(target, prop);\n\t\t},\n\t\townKeys(target) {\n\t\t\treturn Reflect.ownKeys(target).filter((key) => key !== \"$scramjet\");\n\t\t},\n\t\tdefineProperty(target, property, attributes) {\n\t\t\tif (!attributes.get && !attributes.set) {\n\t\t\t\tattributes.writable = true;\n\t\t\t}\n\t\t\tattributes.configurable = true;\n\n\t\t\treturn Reflect.defineProperty(target, property, attributes);\n\t\t},\n\t\tgetOwnPropertyDescriptor: getOwnPropertyDescriptorHandler,\n\t});\n}\n","export function getOwnPropertyDescriptorHandler(target, prop) {\n\tconst realDescriptor = Reflect.getOwnPropertyDescriptor(target, prop);\n\n\treturn realDescriptor;\n}\n","// entrypoint for scramjet.client.js\n\nimport { loadCodecs } from \"../scramjet\";\nimport { SCRAMJETCLIENT } from \"../symbols\";\nimport { ScramjetClient } from \"./client\";\nimport { ScramjetContextEvent, UrlChangeEvent } from \"./events\";\nimport { ScramjetServiceWorkerRuntime } from \"./swruntime\";\n\nexport const iswindow = \"window\" in self && window instanceof Window;\nexport const isworker = \"WorkerGlobalScope\" in self;\nexport const issw = \"ServiceWorkerGlobalScope\" in self;\nexport const isdedicated = \"DedicatedWorkerGlobalScope\" in self;\nexport const isshared = \"SharedWorkerGlobalScope\" in self;\nexport const isemulatedsw =\n\tnew URL(self.location.href).searchParams.get(\"dest\") === \"serviceworker\";\n\ndbg.log(\"initializing scramjet client\");\n// if it already exists, that means the handlers have probably already been setup by the parent document\nif (!(SCRAMJETCLIENT in <Partial<typeof self>>self)) {\n\tloadCodecs();\n\n\tconst client = new ScramjetClient(self);\n\n\tif (self.COOKIE) client.loadcookies(self.COOKIE);\n\n\tclient.hook();\n\n\tif (isemulatedsw) {\n\t\tconst runtime = new ScramjetServiceWorkerRuntime(client);\n\t\truntime.hook();\n\t}\n\n\tconst contextev = new ScramjetContextEvent(client.global.window);\n\tclient.frame?.dispatchEvent(contextev);\n\tconst urlchangeev = new UrlChangeEvent(client.url.href);\n\tif (!client.isSubframe) client.frame?.dispatchEvent(urlchangeev);\n}\n\nReflect.deleteProperty(self, \"WASM\");\nReflect.deleteProperty(self, \"COOKIE\");\nif (\"document\" in self && document?.currentScript) {\n\tdocument.currentScript.remove();\n}\n","// @ts-nocheck\nimport { ScramjetClient } from \"./client\";\nimport { nativeGetOwnPropertyDescriptor } from \"./natives\";\nimport { rewriteUrl } from \"../shared\";\nimport { UrlChangeEvent } from \"./events\";\nimport { iswindow } from \".\";\n\nexport function createLocationProxy(\n\tclient: ScramjetClient,\n\tself: typeof globalThis\n) {\n\tconst Location = iswindow ? self.Location : self.WorkerLocation;\n\t// location cannot be Proxy()d\n\tconst fakeLocation = {};\n\tObject.setPrototypeOf(fakeLocation, Location.prototype);\n\tfakeLocation.constructor = Location;\n\n\t// for some reason it's on the object for Location and on the prototype for WorkerLocation??\n\tconst descriptorSource = iswindow ? self.location : Location.prototype;\n\tconst urlprops = [\n\t\t\"protocol\",\n\t\t\"hash\",\n\t\t\"host\",\n\t\t\"hostname\",\n\t\t\"href\",\n\t\t\"origin\",\n\t\t\"pathname\",\n\t\t\"port\",\n\t\t\"search\",\n\t];\n\tfor (const prop of urlprops) {\n\t\tconst native = nativeGetOwnPropertyDescriptor(descriptorSource, prop);\n\t\tif (!native) continue;\n\n\t\tconst desc = {\n\t\t\tconfigurable: true,\n\t\t\tenumerable: true,\n\t\t};\n\t\tif (native.get) {\n\t\t\tdesc.get = new Proxy(native.get, {\n\t\t\t\tapply() {\n\t\t\t\t\treturn client.url[prop];\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\tif (native.set) {\n\t\t\tdesc.set = new Proxy(native.set, {\n\t\t\t\tapply(target, that, args) {\n\t\t\t\t\tif (prop === \"href\") {\n\t\t\t\t\t\t// special case\n\t\t\t\t\t\tclient.url = args[0];\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (prop === \"hash\") {\n\t\t\t\t\t\tself.location.hash = args[0];\n\t\t\t\t\t\tconst ev = new UrlChangeEvent(client.url.href);\n\t\t\t\t\t\tif (client.frame) client.frame.dispatchEvent(ev);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst url = new URL(client.url.href);\n\t\t\t\t\turl[prop] = args[0];\n\t\t\t\t\tclient.url = url;\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\tObject.defineProperty(fakeLocation, prop, desc);\n\t}\n\n\t// functions\n\tfakeLocation.toString = new Proxy(self.location.toString, {\n\t\tapply() {\n\t\t\treturn client.url.href;\n\t\t},\n\t});\n\n\tif (self.location.valueOf)\n\t\tfakeLocation.valueOf = new Proxy(self.location.valueOf, {\n\t\t\tapply() {\n\t\t\t\treturn client.url.href;\n\t\t\t},\n\t\t});\n\tif (self.location.assign)\n\t\tfakeLocation.assign = new Proxy(self.location.assign, {\n\t\t\tapply(target, that, args) {\n\t\t\t\targs[0] = rewriteUrl(args[0], client.meta);\n\t\t\t\tReflect.apply(target, self.location, args);\n\t\t\t},\n\t\t});\n\tif (self.location.reload)\n\t\tfakeLocation.reload = new Proxy(self.location.reload, {\n\t\t\tapply(target, that, args) {\n\t\t\t\tReflect.apply(target, self.location, args);\n\t\t\t},\n\t\t});\n\tif (self.location.replace)\n\t\tfakeLocation.replace = new Proxy(self.location.replace, {\n\t\t\tapply(target, that, args) {\n\t\t\t\targs[0] = rewriteUrl(args[0], client.meta);\n\t\t\t\tReflect.apply(target, self.location, args);\n\t\t\t},\n\t\t});\n\n\treturn fakeLocation;\n}\n","export const nativeFunction = self.Function;\nexport const nativeGetOwnPropertyDescriptor =\n\tself.Object.getOwnPropertyDescriptor;\n","import { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient) {\n\tclient.Proxy(\"console.clear\", {\n\t\tapply(ctx) {\n\t\t\t// fuck you\n\t\t\tctx.return(undefined);\n\t\t},\n\t});\n\n\tconst log = console.log;\n\tclient.Trap(\"console.log\", {\n\t\tset(_ctx, _v) {\n\t\t\t// is there a legitimate reason to let sites do this?\n\t\t},\n\t\tget(_ctx) {\n\t\t\treturn log;\n\t\t},\n\t});\n}\n","import { rewriteBlob, unrewriteBlob } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\nexport default function (client: ScramjetClient) {\n\t// hide the origin from object urls from the page\n\tclient.Proxy(\"URL.createObjectURL\", {\n\t\tapply(ctx) {\n\t\t\tconst url: string = ctx.call();\n\t\t\tif (url.startsWith(\"blob:\")) {\n\t\t\t\tctx.return(rewriteBlob(url, client.meta));\n\t\t\t} else {\n\t\t\t\tctx.return(url);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"URL.revokeObjectURL\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[0] = unrewriteBlob(ctx.args[0]);\n\t\t},\n\t});\n}\n","import { rewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tclient.Proxy(\"CacheStorage.prototype.open\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[0] = `${client.url.origin}@${ctx.args[0]}`;\n\t\t},\n\t});\n\n\tclient.Proxy(\"CacheStorage.prototype.has\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[0] = `${client.url.origin}@${ctx.args[0]}`;\n\t\t},\n\t});\n\n\tclient.Proxy(\"CacheStorage.prototype.match\", {\n\t\tapply(ctx) {\n\t\t\tif (typeof ctx.args[0] === \"string\" || ctx.args[0] instanceof URL) {\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"CacheStorage.prototype.delete\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[0] = `${client.url.origin}@${ctx.args[0]}`;\n\t\t},\n\t});\n\n\tclient.Proxy(\"Cache.prototype.add\", {\n\t\tapply(ctx) {\n\t\t\tif (typeof ctx.args[0] === \"string\" || ctx.args[0] instanceof URL) {\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Cache.prototype.addAll\", {\n\t\tapply(ctx) {\n\t\t\tfor (let i = 0; i < ctx.args[0].length; i++) {\n\t\t\t\tif (\n\t\t\t\t\ttypeof ctx.args[0][i] === \"string\" ||\n\t\t\t\t\tctx.args[0][i] instanceof URL\n\t\t\t\t) {\n\t\t\t\t\tctx.args[0][i] = rewriteUrl(ctx.args[0][i], client.meta);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Cache.prototype.put\", {\n\t\tapply(ctx) {\n\t\t\tif (typeof ctx.args[0] === \"string\" || ctx.args[0] instanceof URL) {\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Cache.prototype.match\", {\n\t\tapply(ctx) {\n\t\t\tif (typeof ctx.args[0] === \"string\" || ctx.args[0] instanceof URL) {\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Cache.prototype.matchAll\", {\n\t\tapply(ctx) {\n\t\t\tif (\n\t\t\t\t(ctx.args[0] && typeof ctx.args[0] === \"string\") ||\n\t\t\t\t(ctx.args[0] && ctx.args[0] instanceof URL)\n\t\t\t) {\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Cache.prototype.keys\", {\n\t\tapply(ctx) {\n\t\t\tif (\n\t\t\t\t(ctx.args[0] && typeof ctx.args[0] === \"string\") ||\n\t\t\t\t(ctx.args[0] && ctx.args[0] instanceof URL)\n\t\t\t) {\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Cache.prototype.delete\", {\n\t\tapply(ctx) {\n\t\t\tif (typeof ctx.args[0] === \"string\" || ctx.args[0] instanceof URL) {\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t\t}\n\t\t},\n\t});\n}\n","import { flagEnabled } from \"../../scramjet\";\nimport { ScramjetClient } from \"../client\";\n\nexport const enabled = (client: ScramjetClient) =>\n\tflagEnabled(\"captureErrors\", client.url);\nexport function argdbg(arg, recurse = []) {\n\tswitch (typeof arg) {\n\t\tcase \"string\":\n\t\t\tbreak;\n\t\tcase \"object\":\n\t\t\tif (\n\t\t\t\targ &&\n\t\t\t\targ[Symbol.iterator] &&\n\t\t\t\ttypeof arg[Symbol.iterator] === \"function\"\n\t\t\t)\n\t\t\t\tfor (const prop in arg) {\n\t\t\t\t\t// make sure it's not a getter\n\t\t\t\t\tconst desc = Object.getOwnPropertyDescriptor(arg, prop);\n\t\t\t\t\tif (desc && desc.get) continue;\n\n\t\t\t\t\tconst ar = arg[prop];\n\t\t\t\t\tif (recurse.includes(ar)) continue;\n\t\t\t\t\trecurse.push(ar);\n\t\t\t\t\targdbg(ar, recurse);\n\t\t\t\t}\n\t\t\tbreak;\n\t}\n}\n\nexport default function (client: ScramjetClient, self: typeof globalThis) {\n\tself.$scramerr = function scramerr(e) {\n\t\tconsole.warn(\"CAUGHT ERROR\", e);\n\t};\n\n\tself.$scramdbg = function scramdbg(args, t) {\n\t\tif (args && typeof args === \"object\" && args.length > 0) argdbg(args);\n\t\targdbg(t);\n\n\t\treturn t;\n\t};\n\n\tclient.Proxy(\"Promise.prototype.catch\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0])\n\t\t\t\tctx.args[0] = new Proxy(ctx.args[0], {\n\t\t\t\t\tapply(target, that, args) {\n\t\t\t\t\t\t// console.warn(\"CAUGHT PROMISE REJECTION\", args);\n\t\t\t\t\t\tReflect.apply(target, that, args);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t},\n\t});\n}\n","import { flagEnabled } from \"../../scramjet\";\nimport { config, unrewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\n\nexport const enabled = (client: ScramjetClient) =>\n\tflagEnabled(\"cleanErrors\", client.url);\n\nexport default function (client: ScramjetClient, _self: Self) {\n\t// v8 only. all we need to do is clean the scramjet urls from stack traces\n\tconst closure = (error, stack) => {\n\t\tlet newstack = error.stack;\n\n\t\tfor (let i = 0; i < stack.length; i++) {\n\t\t\tconst url = stack[i].getFileName();\n\n\t\t\tif (url.endsWith(config.files.client)) {\n\t\t\t\t// strip stack frames including scramjet handlers from the trace\n\t\t\t\tconst lines = newstack.split(\"\\n\");\n\t\t\t\tconst line = lines.find((l) => l.includes(url));\n\t\t\t\tlines.splice(line, 1);\n\t\t\t\tnewstack = lines.join(\"\\n\");\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tnewstack = newstack.replaceAll(url, unrewriteUrl(url));\n\t\t\t} catch {}\n\t\t}\n\n\t\treturn newstack;\n\t};\n\tclient.Trap(\"Error.prepareStackTrace\", {\n\t\tget(_ctx) {\n\t\t\t// this is a funny js quirk. the getter is ran every time you type something in console\n\t\t\treturn closure;\n\t\t},\n\t\tset(_value) {\n\t\t\t// just ignore it if a site tries setting their own. not much we can really do\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\nimport { config, rewriteJs } from \"../../shared\";\n\nexport default function (client: ScramjetClient, self: Self) {\n\t// used for proxying *direct eval*\n\t// eval(\"...\") -> eval($scramjet$rewrite(\"...\"))\n\tObject.defineProperty(self, config.globals.rewritefn, {\n\t\tvalue: function (js: any) {\n\t\t\tif (typeof js !== \"string\") return js;\n\n\t\t\tconst rewritten = rewriteJs(js, \"(direct eval proxy)\", client.meta);\n\n\t\t\treturn rewritten;\n\t\t},\n\t\twritable: false,\n\t\tconfigurable: false,\n\t});\n}\n\nexport function indirectEval(this: ScramjetClient, strict: boolean, js: any) {\n\t// > If the argument of eval() is not a string, eval() returns the argument unchanged\n\tif (typeof js !== \"string\") return js;\n\n\tlet indirection: Function;\n\tif (strict) {\n\t\tconsole.log(\"STRICT\");\n\t\tindirection = new Function(`\n\t\t\t\"use strict\";\n\t\t\treturn eval;\n\t\t`);\n\t} else {\n\t\tindirection = this.global.eval;\n\t}\n\n\treturn indirection(\n\t\trewriteJs(js, \"(indirect eval proxy)\", this.meta) as string\n\t);\n}\n","import { iswindow } from \"..\";\nimport { SCRAMJETCLIENT } from \"../../symbols\";\nimport { ScramjetClient } from \"../client\";\nimport { getOwnPropertyDescriptorHandler } from \"../helpers\";\nimport { nativeGetOwnPropertyDescriptor } from \"../natives\";\nimport { unproxy } from \"./unproxy\";\n\nconst realOnEvent = Symbol.for(\"scramjet original onevent function\");\n\nexport default function (client: ScramjetClient, self: Self) {\n\tconst handlers = {\n\t\tmessage: {\n\t\t\t_init() {\n\t\t\t\tif (typeof this.data === \"object\" && \"$scramjet$type\" in this.data) {\n\t\t\t\t\t// this is a ctl message\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tports() {\n\t\t\t\t// don't know why i have to do this?\n\t\t\t\treturn this.ports;\n\t\t\t},\n\t\t\tsource() {\n\t\t\t\tif (this.source === null) return null;\n\n\t\t\t\tconst scram: ScramjetClient = this.source[SCRAMJETCLIENT];\n\n\t\t\t\tif (scram) return scram.globalProxy;\n\n\t\t\t\treturn this.source;\n\t\t\t},\n\t\t\torigin() {\n\t\t\t\tif (typeof this.data === \"object\" && \"$scramjet$origin\" in this.data)\n\t\t\t\t\treturn this.data.$scramjet$origin;\n\n\t\t\t\treturn client.url.origin;\n\t\t\t},\n\t\t\tdata() {\n\t\t\t\tif (typeof this.data === \"object\" && \"$scramjet$data\" in this.data)\n\t\t\t\t\treturn this.data.$scramjet$data;\n\n\t\t\t\treturn this.data;\n\t\t\t},\n\t\t},\n\t};\n\n\tfunction wraplistener(listener: (...args: any) => any) {\n\t\treturn new Proxy(listener, {\n\t\t\tapply(target, that, args) {\n\t\t\t\tconst realEvent: Event = args[0];\n\n\t\t\t\t// we only need to handle events dispatched from the browser\n\t\t\t\tif (realEvent.isTrusted) {\n\t\t\t\t\tconst type = realEvent.type;\n\n\t\t\t\t\tif (type in handlers) {\n\t\t\t\t\t\tconst handler = handlers[type];\n\n\t\t\t\t\t\tif (handler._init) {\n\t\t\t\t\t\t\tif (handler._init.call(realEvent) === false) return;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\targs[0] = new Proxy(realEvent, {\n\t\t\t\t\t\t\tget(_target, prop, reciever) {\n\t\t\t\t\t\t\t\tif (prop in handler) {\n\t\t\t\t\t\t\t\t\treturn handler[prop].call(_target);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn Reflect.get(target, prop, reciever);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tgetOwnPropertyDescriptor: getOwnPropertyDescriptorHandler,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!self.event) {\n\t\t\t\t\tObject.defineProperty(self, \"event\", {\n\t\t\t\t\t\tget() {\n\t\t\t\t\t\t\treturn args[0];\n\t\t\t\t\t\t},\n\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tconst rv = Reflect.apply(target, that, args);\n\n\t\t\t\treturn rv;\n\t\t\t},\n\t\t\tgetOwnPropertyDescriptor: getOwnPropertyDescriptorHandler,\n\t\t});\n\t}\n\n\tclient.Proxy(\"EventTarget.prototype.addEventListener\", {\n\t\tapply(ctx) {\n\t\t\tunproxy(ctx, client);\n\t\t\tif (typeof ctx.args[1] !== \"function\") return;\n\n\t\t\tconst origlistener = ctx.args[1];\n\t\t\tconst proxylistener = wraplistener(origlistener);\n\n\t\t\tctx.args[1] = proxylistener;\n\n\t\t\tlet arr = client.eventcallbacks.get(ctx.this);\n\t\t\tarr ||= [] as any;\n\t\t\tarr.push({\n\t\t\t\tevent: ctx.args[0] as string,\n\t\t\t\toriginalCallback: origlistener,\n\t\t\t\tproxiedCallback: proxylistener,\n\t\t\t});\n\t\t\tclient.eventcallbacks.set(ctx.this, arr);\n\t\t},\n\t});\n\n\tclient.Proxy(\"EventTarget.prototype.removeEventListener\", {\n\t\tapply(ctx) {\n\t\t\tunproxy(ctx, client);\n\t\t\tif (typeof ctx.args[1] !== \"function\") return;\n\n\t\t\tconst arr = client.eventcallbacks.get(ctx.this);\n\t\t\tif (!arr) return;\n\n\t\t\tconst i = arr.findIndex(\n\t\t\t\t(e) => e.event === ctx.args[0] && e.originalCallback === ctx.args[1]\n\t\t\t);\n\t\t\tif (i === -1) return;\n\n\t\t\tconst r = arr.splice(i, 1);\n\t\t\tclient.eventcallbacks.set(ctx.this, arr);\n\n\t\t\tctx.args[1] = r[0].proxiedCallback;\n\t\t},\n\t});\n\n\tclient.Proxy(\"EventTarget.prototype.dispatchEvent\", {\n\t\tapply(ctx) {\n\t\t\tunproxy(ctx, client);\n\t\t},\n\t});\n\n\tconst targets = [self.self, self.MessagePort.prototype] as Array<any>;\n\tif (iswindow) targets.push(self.HTMLElement.prototype);\n\tif (self.Worker) targets.push(self.Worker.prototype);\n\n\tfor (const target of targets) {\n\t\tconst keys = Reflect.ownKeys(target);\n\n\t\tfor (const key of keys) {\n\t\t\tif (\n\t\t\t\ttypeof key === \"string\" &&\n\t\t\t\tkey.startsWith(\"on\") &&\n\t\t\t\thandlers[key.slice(2)]\n\t\t\t) {\n\t\t\t\tconst descriptor = nativeGetOwnPropertyDescriptor(target, key);\n\t\t\t\tif (!descriptor.get || !descriptor.set || !descriptor.configurable)\n\t\t\t\t\tcontinue;\n\n\t\t\t\t// these are the `onmessage`, `onclick`, etc. properties\n\t\t\t\tclient.RawTrap(target, key, {\n\t\t\t\t\tget(ctx) {\n\t\t\t\t\t\tif (this[realOnEvent]) return this[realOnEvent];\n\n\t\t\t\t\t\treturn ctx.get();\n\t\t\t\t\t},\n\t\t\t\t\tset(ctx, value: any) {\n\t\t\t\t\t\tthis[realOnEvent] = value;\n\n\t\t\t\t\t\tif (typeof value !== \"function\") return ctx.set(value);\n\n\t\t\t\t\t\tctx.set(wraplistener(value));\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n}\n","import { ScramjetClient, ProxyCtx, Proxy } from \"../client\";\nimport { rewriteJs } from \"../../shared\";\n\nfunction rewriteFunction(ctx: ProxyCtx, client: ScramjetClient) {\n\tconst stringifiedFunction = ctx.call().toString();\n\n\tconst content = rewriteJs(\n\t\tstringifiedFunction,\n\t\t\"(function proxy)\",\n\t\tclient.meta\n\t);\n\tctx.return(ctx.fn(`return ${content}`)());\n}\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tconst handler: Proxy = {\n\t\tapply(ctx: ProxyCtx) {\n\t\t\trewriteFunction(ctx, client);\n\t\t},\n\t\tconstruct(ctx) {\n\t\t\trewriteFunction(ctx, client);\n\t\t},\n\t};\n\n\tclient.Proxy(\"Function\", handler);\n\t/*\n\t// god i love javascript\n\tclient.RawProxy(function () {}.constructor.prototype, \"constructor\", handler);\n\tclient.RawProxy(\n\t\tasync function () {}.constructor.prototype,\n\t\t\"constructor\",\n\t\thandler\n\t);\n\tclient.RawProxy(\n\t\tfunction* () {}.constructor.prototype,\n\t\t\"constructor\",\n\t\thandler\n\t);\n\tclient.RawProxy(\n\t\tasync function* () {}.constructor.prototype,\n\t\t\"constructor\",\n\t\thandler\n\t);\n\t*/\n}\n","import { ScramjetClient } from \"../client\";\nimport { config } from \"../../shared\";\nimport { rewriteUrl } from \"../../shared/rewriters/url\";\n\nexport default function (client: ScramjetClient, self: Self) {\n\tconst Function = client.natives.store[\"Function\"];\n\n\tself[config.globals.importfn] = function (base: string, url: string) {\n\t\tconst resolved = new URL(url, base).href;\n\n\t\treturn Function(`return import(\"${rewriteUrl(resolved, client.meta)}\")`)();\n\t};\n\n\tself[config.globals.metafn] = function (base: string) {\n\t\treturn {\n\t\t\turl: base,\n\t\t\tresolve: function (url: string) {\n\t\t\t\treturn new URL(url, base).href;\n\t\t\t},\n\t\t};\n\t};\n}\n","import { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient) {\n\tclient.Proxy(\"IDBFactory.prototype.open\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[0] = `${client.url.origin}@${ctx.args[0]}`;\n\t\t},\n\t});\n\n\tclient.Trap(\"IDBDatabase.prototype.name\", {\n\t\tget(ctx) {\n\t\t\tconst name = ctx.get() as string;\n\n\t\t\treturn name.substring(name.indexOf(\"@\") + 1);\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, self: Self) {\n\tclient.Proxy(\"StorageManager.prototype.getDirectory\", {\n\t\tapply(ctx) {\n\t\t\tconst rootPromise = ctx.call() as Promise<FileSystemDirectoryHandle>;\n\t\t\tctx.return(\n\t\t\t\t(async () => {\n\t\t\t\t\tconst root = await rootPromise;\n\t\t\t\t\tconst directory = await root.getDirectoryHandle(\n\t\t\t\t\t\t`${client.url.origin.replace(/\\/|\\s|\\./g, \"-\")}`,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcreate: true,\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tObject.defineProperty(directory, \"name\", {\n\t\t\t\t\t\tvalue: \"\",\n\t\t\t\t\t\twritable: false,\n\t\t\t\t\t});\n\n\t\t\t\t\treturn directory;\n\t\t\t\t})()\n\t\t\t);\n\t\t},\n\t});\n}\n","import { iswindow } from \"..\";\nimport { SCRAMJETCLIENT } from \"../../symbols\";\nimport { ScramjetClient } from \"../client\";\nimport { POLLUTANT } from \"../shared/realm\";\n\nexport default function (client: ScramjetClient) {\n\tif (iswindow)\n\t\tclient.Proxy(\"window.postMessage\", {\n\t\t\tapply(ctx) {\n\t\t\t\t// so we need to send the real origin here, since the recieving window can't possibly know.\n\t\t\t\t// except, remember that this code is being ran in a different realm than the invoker, so if we ask our `client` it may give us the wrong origin\n\t\t\t\t// if we were given any object that came from the real realm we can use that to get the real origin\n\t\t\t\t// and this works in every case EXCEPT for the fact that all three arguments can be strings which are copied instead of cloned\n\t\t\t\t// so we have to use `$setrealm` which will pollute this with an object from the real realm\n\n\t\t\t\tlet pollutant;\n\n\t\t\t\tif (typeof ctx.args[0] === \"object\" && ctx.args[0] !== null) {\n\t\t\t\t\tpollutant = ctx.args[0]; // try to use the first object we can find because it's more reliable\n\t\t\t\t} else if (typeof ctx.args[2] === \"object\" && ctx.args[2] !== null) {\n\t\t\t\t\tpollutant = ctx.args[2]; // next try to use transfer\n\t\t\t\t} else if (\n\t\t\t\t\tctx.this &&\n\t\t\t\t\tPOLLUTANT in ctx.this &&\n\t\t\t\t\ttypeof ctx.this[POLLUTANT] === \"object\" &&\n\t\t\t\t\tctx.this[POLLUTANT] !== null\n\t\t\t\t) {\n\t\t\t\t\tpollutant = ctx.this[POLLUTANT]; // lastly try to use the object from $setrealm\n\t\t\t\t} else {\n\t\t\t\t\tpollutant = {}; // give up\n\t\t\t\t}\n\n\t\t\t\t// and now we can steal Function from the caller's realm\n\t\t\t\tconst {\n\t\t\t\t\tconstructor: { constructor: Function },\n\t\t\t\t} = pollutant;\n\n\t\t\t\t// invoking stolen function will give us the caller's globalThis, remember scramjet has already proxied it!!!\n\t\t\t\tconst callerGlobalThisProxied: Self = Function(\"return globalThis\")();\n\t\t\t\tconst callerClient = callerGlobalThisProxied[SCRAMJETCLIENT];\n\n\t\t\t\t// this WOULD be enough but the source argument of MessageEvent has to return the caller's window\n\t\t\t\t// and if we just call it normally it would be coming from here, which WILL NOT BE THE CALLER'S because the accessor is from the parent\n\t\t\t\t// so with the stolen function we wrap postmessage so the source will truly be the caller's window (remember that function is scramjet's!!!)\n\t\t\t\tconst wrappedPostMessage = Function(\"...args\", \"this(...args)\");\n\n\t\t\t\tctx.args[0] = {\n\t\t\t\t\t$scramjet$messagetype: \"window\",\n\t\t\t\t\t$scramjet$origin: callerClient.url.origin,\n\t\t\t\t\t$scramjet$data: ctx.args[0],\n\t\t\t\t};\n\n\t\t\t\t// * origin because obviously\n\t\t\t\tif (typeof ctx.args[1] === \"string\") ctx.args[1] = \"*\";\n\t\t\t\tif (typeof ctx.args[1] === \"object\") ctx.args[1].targetOrigin = \"*\";\n\n\t\t\t\tctx.return(wrappedPostMessage.call(ctx.fn, ...ctx.args));\n\t\t\t},\n\t\t});\n\n\tconst toproxy = [\"MessagePort.prototype.postMessage\"];\n\n\tif (self.Worker) toproxy.push(\"Worker.prototype.postMessage\");\n\tif (!iswindow) toproxy.push(\"self.postMessage\"); // only do the generic version if we're in a worker\n\n\tclient.Proxy(toproxy, {\n\t\tapply(ctx) {\n\t\t\t// origin/source doesn't need to be preserved - it's null in the message event\n\n\t\t\tctx.args[0] = {\n\t\t\t\t$scramjet$messagetype: \"worker\",\n\t\t\t\t$scramjet$data: ctx.args[0],\n\t\t\t};\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\nimport { config } from \"../../shared\";\n\nexport const POLLUTANT = Symbol.for(\"scramjet realm pollutant\");\n\nexport default function (client: ScramjetClient, self: typeof globalThis) {\n\t// object.$setrealm({}).postMessage(...)\n\t// the empty object is the \"pollutant\" which can reconstruct the real realm\n\t// i explain more in postmessage.ts\n\tObject.defineProperty(self.Object.prototype, config.globals.setrealmfn, {\n\t\tvalue(pollution: object) {\n\t\t\t// this is bad!! sites could detect this\n\t\t\tObject.defineProperty(this, POLLUTANT, {\n\t\t\t\tvalue: pollution,\n\t\t\t\twritable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tenumerable: false,\n\t\t\t});\n\n\t\t\treturn this;\n\t\t},\n\t\twritable: true,\n\t\tconfigurable: true,\n\t\tenumerable: false,\n\t});\n}\n","import { unrewriteUrl, rewriteUrl } from \"../../../shared\";\nimport { ScramjetClient } from \"../../client\";\n\nexport default function (client: ScramjetClient) {\n\tclient.Proxy(\"EventSource\", {\n\t\tconstruct(ctx) {\n\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t},\n\t});\n\n\tclient.Trap(\"EventSource.prototype.url\", {\n\t\tget(ctx) {\n\t\t\tunrewriteUrl(ctx.get() as string);\n\t\t},\n\t});\n}\n","// ts throws an error if you dont do window.fetch\n\nimport { isemulatedsw } from \"../..\";\nimport { unrewriteUrl } from \"../../../shared\";\nimport { ScramjetClient } from \"../../client\";\nimport { rewriteUrl } from \"../../../shared\";\n\nexport default function (client: ScramjetClient, _self: typeof globalThis) {\n\tclient.Proxy(\"fetch\", {\n\t\tapply(ctx) {\n\t\t\tif (typeof ctx.args[0] === \"string\" || ctx.args[0] instanceof URL) {\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\n\t\t\t\tif (isemulatedsw) ctx.args[0] += \"?from=swruntime\";\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Request\", {\n\t\tconstruct(ctx) {\n\t\t\tif (typeof ctx.args[0] === \"string\" || ctx.args[0] instanceof URL) {\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\n\t\t\t\tif (isemulatedsw) ctx.args[0] += \"?from=swruntime\";\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Trap(\"Response.prototype.url\", {\n\t\tget(ctx) {\n\t\t\treturn unrewriteUrl(ctx.get() as string);\n\t\t},\n\t});\n\n\tclient.Trap(\"Request.prototype.url\", {\n\t\tget(ctx) {\n\t\t\treturn unrewriteUrl(ctx.get() as string);\n\t\t},\n\t});\n}\n","import { type BareWebSocket } from \"@mercuryworkshop/bare-mux\";\nimport { ScramjetClient } from \"../../client\";\n\ntype FakeWebSocketState = {\n\textensions: string;\n\tprotocol: string;\n\turl: string;\n\tbinaryType: string;\n\tbarews: BareWebSocket;\n\n\tonclose?: (ev: CloseEvent) => any;\n\tonerror?: (ev: Event) => any;\n\tonmessage?: (ev: MessageEvent) => any;\n\tonopen?: (ev: Event) => any;\n};\ntype FakeWebSocketStreamState = {\n\textensions: string;\n\tprotocol: string;\n\turl: string;\n\tbarews: BareWebSocket;\n\n\topened: any;\n\tclosed: any;\n\treadable: ReadableStream;\n\twritable: WritableStream;\n};\nexport default function (client: ScramjetClient, self: typeof globalThis) {\n\tconst socketmap: WeakMap<WebSocket, FakeWebSocketState> = new WeakMap();\n\tconst socketstreammap: WeakMap<object, FakeWebSocketStreamState> =\n\t\tnew WeakMap();\n\tclient.Proxy(\"WebSocket\", {\n\t\tconstruct(ctx) {\n\t\t\tconst fakeWebSocket = new EventTarget() as WebSocket;\n\t\t\tObject.setPrototypeOf(fakeWebSocket, ctx.fn.prototype);\n\t\t\tfakeWebSocket.constructor = ctx.fn;\n\n\t\t\tconst trustEvent = (ev: Event) =>\n\t\t\t\tnew Proxy(ev, {\n\t\t\t\t\tget(target, prop) {\n\t\t\t\t\t\tif (prop === \"isTrusted\") return true;\n\n\t\t\t\t\t\treturn Reflect.get(target, prop);\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\tconst barews = client.bare.createWebSocket(\n\t\t\t\tctx.args[0],\n\t\t\t\tctx.args[1],\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\t\"User-Agent\": self.navigator.userAgent,\n\t\t\t\t\tOrigin: client.url.origin,\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tconst state: FakeWebSocketState = {\n\t\t\t\textensions: \"\",\n\t\t\t\tprotocol: \"\",\n\t\t\t\turl: ctx.args[0],\n\t\t\t\tbinaryType: \"blob\",\n\t\t\t\tbarews,\n\n\t\t\t\tonclose: null,\n\t\t\t\tonerror: null,\n\t\t\t\tonmessage: null,\n\t\t\t\tonopen: null,\n\t\t\t};\n\n\t\t\tfunction fakeEventSend(fakeev: Event) {\n\t\t\t\tstate[\"on\" + fakeev.type]?.(trustEvent(fakeev));\n\t\t\t\tfakeWebSocket.dispatchEvent(fakeev);\n\t\t\t}\n\n\t\t\tbarews.addEventListener(\"open\", () => {\n\t\t\t\tfakeEventSend(new Event(\"open\"));\n\t\t\t});\n\t\t\tbarews.addEventListener(\"close\", (ev) => {\n\t\t\t\tfakeEventSend(new CloseEvent(\"close\", ev));\n\t\t\t});\n\t\t\tbarews.addEventListener(\"message\", async (ev) => {\n\t\t\t\tlet payload = ev.data;\n\t\t\t\tif (typeof payload === \"string\") {\n\t\t\t\t\t// DO NOTHING\n\t\t\t\t} else if (\"byteLength\" in payload) {\n\t\t\t\t\t// arraybuffer, convert to blob if needed or set the proper prototype\n\t\t\t\t\tif (state.binaryType === \"blob\") {\n\t\t\t\t\t\tpayload = new Blob([payload]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tObject.setPrototypeOf(payload, ArrayBuffer.prototype);\n\t\t\t\t\t}\n\t\t\t\t} else if (\"arrayBuffer\" in payload) {\n\t\t\t\t\t// blob, convert to arraybuffer if neccesary.\n\t\t\t\t\tif (state.binaryType === \"arraybuffer\") {\n\t\t\t\t\t\tpayload = await payload.arrayBuffer();\n\t\t\t\t\t\tObject.setPrototypeOf(payload, ArrayBuffer.prototype);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst fakeev = new MessageEvent(\"message\", {\n\t\t\t\t\tdata: payload,\n\t\t\t\t\torigin: ev.origin,\n\t\t\t\t\tlastEventId: ev.lastEventId,\n\t\t\t\t\tsource: ev.source,\n\t\t\t\t\tports: ev.ports,\n\t\t\t\t});\n\n\t\t\t\tfakeEventSend(fakeev);\n\t\t\t});\n\t\t\tbarews.addEventListener(\"error\", () => {\n\t\t\t\tfakeEventSend(new Event(\"error\"));\n\t\t\t});\n\n\t\t\tsocketmap.set(fakeWebSocket, state);\n\t\t\tctx.return(fakeWebSocket);\n\t\t},\n\t});\n\tclient.Trap(\"WebSocket.prototype.binaryType\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.binaryType;\n\t\t},\n\t\tset(ctx, v: string) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\t\t\tif (v === \"blob\" || v === \"arraybuffer\") ws.binaryType = v;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.bufferedAmount\", {\n\t\tget() {\n\t\t\treturn 0;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.extensions\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.extensions;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.onclose\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.onclose;\n\t\t},\n\t\tset(ctx, v: (ev: CloseEvent) => any) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\t\t\tws.onclose = v;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.onerror\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.onerror;\n\t\t},\n\t\tset(ctx, v: (ev: Event) => any) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\t\t\tws.onerror = v;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.onmessage\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.onmessage;\n\t\t},\n\t\tset(ctx, v: (ev: MessageEvent) => any) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\t\t\tws.onmessage = v;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.onopen\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.onopen;\n\t\t},\n\t\tset(ctx, v: (ev: Event) => any) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\t\t\tws.onopen = v;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.url\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.url;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.protocol\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.protocol;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.readyState\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.barews.readyState;\n\t\t},\n\t});\n\n\tclient.Proxy(\"WebSocket.prototype.send\", {\n\t\tapply(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\tctx.return(ws.barews.send(ctx.args[0]));\n\t\t},\n\t});\n\n\tclient.Proxy(\"WebSocket.prototype.close\", {\n\t\tapply(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\t\t\tif (ctx.args[0] === undefined) ctx.args[0] = 1000;\n\t\t\tif (ctx.args[1] === undefined) ctx.args[1] = \"\";\n\t\t\tctx.return(ws.barews.close(ctx.args[0], ctx.args[1]));\n\t\t},\n\t});\n\n\tclient.Proxy(\"WebSocketStream\", {\n\t\tconstruct(ctx) {\n\t\t\tconst fakeWebSocket = {};\n\t\t\tObject.setPrototypeOf(fakeWebSocket, ctx.fn.prototype);\n\t\t\tfakeWebSocket.constructor = ctx.fn;\n\n\t\t\tconst barews = client.bare.createWebSocket(\n\t\t\t\tctx.args[0],\n\t\t\t\tctx.args[1],\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\t\"User-Agent\": self.navigator.userAgent,\n\t\t\t\t\tOrigin: client.url.origin,\n\t\t\t\t}\n\t\t\t);\n\t\t\tctx.args[1]?.signal.addEventListener(\"abort\", () => {\n\t\t\t\tbarews.close(1000, \"\");\n\t\t\t});\n\t\t\tlet openResolver, closeResolver;\n\t\t\tconst state: FakeWebSocketStreamState = {\n\t\t\t\textensions: \"\",\n\t\t\t\tprotocol: \"\",\n\t\t\t\turl: ctx.args[0],\n\t\t\t\tbarews,\n\n\t\t\t\topened: new Promise((resolve) => {\n\t\t\t\t\topenResolver = resolve;\n\t\t\t\t}),\n\t\t\t\tclosed: new Promise((resolve) => {\n\t\t\t\t\tcloseResolver = resolve;\n\t\t\t\t}),\n\t\t\t\treadable: new ReadableStream({\n\t\t\t\t\tstart(controller) {\n\t\t\t\t\t\tbarews.addEventListener(\"message\", (ev: MessageEvent) => {\n\t\t\t\t\t\t\tconst payload = ev.data;\n\t\t\t\t\t\t\tif (typeof payload === \"string\") {\n\t\t\t\t\t\t\t\t// DO NOTHING\n\t\t\t\t\t\t\t} else if (\"byteLength\" in payload) {\n\t\t\t\t\t\t\t\tObject.setPrototypeOf(payload, ArrayBuffer.prototype);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcontroller.enqueue(payload);\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\twritable: new WritableStream({\n\t\t\t\t\twrite(chunk) {\n\t\t\t\t\t\tbarews.send(chunk);\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t};\n\t\t\tbarews.addEventListener(\"open\", () => {\n\t\t\t\topenResolver({\n\t\t\t\t\treadable: state.readable,\n\t\t\t\t\twritable: state.writable,\n\t\t\t\t\textensions: state.extensions,\n\t\t\t\t\tprotocol: state.protocol,\n\t\t\t\t});\n\t\t\t});\n\t\t\tbarews.addEventListener(\"close\", (ev: CloseEvent) => {\n\t\t\t\tcloseResolver({ code: ev.code, reason: ev.reason });\n\t\t\t});\n\n\t\t\tsocketstreammap.set(fakeWebSocket, state);\n\t\t\tctx.return(fakeWebSocket);\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocketStream.prototype.closed\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketstreammap.get(ctx.this);\n\n\t\t\treturn ws.closed;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocketStream.prototype.opened\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketstreammap.get(ctx.this);\n\n\t\t\treturn ws.opened;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocketStream.prototype.url\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketstreammap.get(ctx.this);\n\n\t\t\treturn ws.url;\n\t\t},\n\t});\n\n\tclient.Proxy(\"WebSocketStream.prototype.close\", {\n\t\tapply(ctx) {\n\t\t\tconst ws = socketstreammap.get(ctx.this);\n\t\t\tif (ctx.args[0]) {\n\t\t\t\tif (ctx.args[0].closeCode === undefined) ctx.args[0].closeCode = 1000;\n\t\t\t\tif (ctx.args[0].reason === undefined) ctx.args[0].reason = \"\";\n\n\t\t\t\treturn ctx.return(\n\t\t\t\t\tws.barews.close(ctx.args[0].closeCode, ctx.args[0].reason)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn ctx.return(ws.barews.close(1000, \"\"));\n\t\t},\n\t});\n}\n","import { flagEnabled } from \"../../../scramjet\";\nimport { config, unrewriteUrl, rewriteUrl } from \"../../../shared\";\nimport { ScramjetClient } from \"../../client\";\n\nexport default function (client: ScramjetClient, self: Self) {\n\tlet worker;\n\tif (self.Worker && flagEnabled(\"syncxhr\", client.url)) {\n\t\tworker = client.natives.construct(\"Worker\", config.files.sync);\n\t}\n\tconst ARGS = Symbol(\"xhr original args\");\n\tconst HEADERS = Symbol(\"xhr headers\");\n\n\tclient.Proxy(\"XMLHttpRequest.prototype.open\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[1]) ctx.args[1] = rewriteUrl(ctx.args[1], client.meta);\n\t\t\tif (ctx.args[2] === undefined) ctx.args[2] = true;\n\t\t\tctx.this[ARGS] = ctx.args;\n\t\t},\n\t});\n\n\tclient.Proxy(\"XMLHttpRequest.prototype.setRequestHeader\", {\n\t\tapply(ctx) {\n\t\t\tconst headers = ctx.this[HEADERS] || (ctx.this[HEADERS] = {});\n\t\t\theaders[ctx.args[0]] = ctx.args[1];\n\t\t},\n\t});\n\n\tclient.Proxy(\"XMLHttpRequest.prototype.send\", {\n\t\tapply(ctx) {\n\t\t\tconst args = ctx.this[ARGS];\n\t\t\tif (!args || args[2]) return;\n\n\t\t\tif (!flagEnabled(\"syncxhr\", client.url)) {\n\t\t\t\tconsole.warn(\"ignoring request - sync xhr disabled in flags\");\n\n\t\t\t\treturn ctx.return(undefined);\n\t\t\t}\n\n\t\t\t// it's a sync request\n\t\t\t// sync xhr to service worker is not supported\n\t\t\t// there's a nice way of polyfilling this though, we can spin on an atomic using sharedarraybuffer. this will maintain the sync behavior\n\n\t\t\t// @ts-expect-error ts dum\n\t\t\tconst sab = new SharedArrayBuffer(1024, { maxByteLength: 2147483647 });\n\t\t\tconst view = new DataView(sab);\n\n\t\t\tclient.natives.call(\"Worker.prototype.postMessage\", worker, {\n\t\t\t\tsab,\n\t\t\t\targs,\n\t\t\t\theaders: ctx.this[HEADERS],\n\t\t\t\tbody: ctx.args[0],\n\t\t\t});\n\n\t\t\tconst now = performance.now();\n\t\t\twhile (view.getUint8(0) === 0) {\n\t\t\t\tif (performance.now() - now > 1000) {\n\t\t\t\t\tthrow new Error(\"xhr timeout\");\n\t\t\t\t}\n\t\t\t\t/* spin */\n\t\t\t}\n\n\t\t\tconst status = view.getUint16(1);\n\t\t\tconst headersLength = view.getUint32(3);\n\n\t\t\tconst headersab = new Uint8Array(headersLength);\n\t\t\theadersab.set(new Uint8Array(sab.slice(7, 7 + headersLength)));\n\t\t\tconst headers = new TextDecoder().decode(headersab);\n\n\t\t\tconst bodyLength = view.getUint32(7 + headersLength);\n\t\t\tconst bodyab = new Uint8Array(bodyLength);\n\t\t\tbodyab.set(\n\t\t\t\tnew Uint8Array(\n\t\t\t\t\tsab.slice(11 + headersLength, 11 + headersLength + bodyLength)\n\t\t\t\t)\n\t\t\t);\n\t\t\tconst body = new TextDecoder().decode(bodyab);\n\n\t\t\t// these should be using proxies to not leak scram strings but who cares\n\t\t\tclient.RawTrap(ctx.this, \"status\", {\n\t\t\t\tget() {\n\t\t\t\t\treturn status;\n\t\t\t\t},\n\t\t\t});\n\t\t\tclient.RawTrap(ctx.this, \"responseText\", {\n\t\t\t\tget() {\n\t\t\t\t\treturn body;\n\t\t\t\t},\n\t\t\t});\n\t\t\tclient.RawTrap(ctx.this, \"response\", {\n\t\t\t\tget() {\n\t\t\t\t\tif (ctx.this.responseType === \"arraybuffer\") return bodyab.buffer;\n\n\t\t\t\t\treturn body;\n\t\t\t\t},\n\t\t\t});\n\t\t\tclient.RawTrap(ctx.this, \"responseXML\", {\n\t\t\t\tget() {\n\t\t\t\t\tconst parser = new DOMParser();\n\n\t\t\t\t\treturn parser.parseFromString(body, \"text/xml\");\n\t\t\t\t},\n\t\t\t});\n\t\t\tclient.RawTrap(ctx.this, \"getAllResponseHeaders\", {\n\t\t\t\tget() {\n\t\t\t\t\treturn () => headers;\n\t\t\t\t},\n\t\t\t});\n\t\t\tclient.RawTrap(ctx.this, \"getResponseHeader\", {\n\t\t\t\tget() {\n\t\t\t\t\treturn (header: string) => {\n\t\t\t\t\t\tconst re = new RegExp(`^${header}: (.*)$`, \"m\");\n\t\t\t\t\t\tconst match = re.exec(headers);\n\n\t\t\t\t\t\treturn match ? match[1] : null;\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t});\n\n\t\t\t// send has no return value right\n\t\t\tctx.return(undefined);\n\t\t},\n\t});\n\n\tclient.Trap(\"XMLHttpRequest.prototype.responseURL\", {\n\t\tget(ctx) {\n\t\t\treturn unrewriteUrl(ctx.get() as string);\n\t\t},\n\t});\n}\n","import { flagEnabled } from \"../../scramjet\";\nimport { SCRAMJETCLIENT, SCRAMJETCLIENTNAME } from \"../../symbols\";\nimport { ProxyCtx, ScramjetClient } from \"../client\";\n\nenum RewriteType {\n\tInsert = 0,\n\tReplace = 1,\n}\n\ntype Rewrite = {\n\tstart: number;\n} & (\n\t| {\n\t\t\ttype: RewriteType.Insert;\n\t\t\tsize: number;\n\t  }\n\t| {\n\t\t\ttype: RewriteType.Replace;\n\t\t\tend: number;\n\t\t\tstr: string;\n\t  }\n);\n\nexport type SourceMaps = Record<string, Rewrite[]>;\n\nfunction getEnd(rewrite: Rewrite): number {\n\tif (rewrite.type === RewriteType.Insert) {\n\t\treturn rewrite.start + rewrite.size;\n\t} else if (rewrite.type === RewriteType.Replace) {\n\t\treturn rewrite.end;\n\t}\n\tthrow \"unreachable\";\n}\n\nconst scramtag_ident = \"/*scramtag \";\n\n// some sites like to steal funcs from frames and then unrewrite them\nfunction searchRewrites(tag: string): Rewrite[] | undefined {\n\tfunction searchFrame(globalThis: Self) {\n\t\tconst SCRAMJETCLIENT = globalThis.Symbol.for(SCRAMJETCLIENTNAME);\n\t\tif (\n\t\t\tglobalThis[SCRAMJETCLIENT] &&\n\t\t\tglobalThis[SCRAMJETCLIENT].sourcemaps &&\n\t\t\tglobalThis[SCRAMJETCLIENT].sourcemaps[tag]\n\t\t)\n\t\t\treturn globalThis[SCRAMJETCLIENT].sourcemaps[tag];\n\n\t\t// no enhanced for :frowning2:\n\t\tfor (let i = 0; i < globalThis.frames.length; i++) {\n\t\t\tconst rewrites = searchFrame(globalThis.frames[i].self);\n\t\t\tif (rewrites) return rewrites;\n\t\t}\n\t}\n\n\tlet globalThis = self;\n\tlet rewrites = searchFrame(globalThis);\n\tif (rewrites) return rewrites;\n\twhile (globalThis.parent && globalThis.parent !== globalThis.window) {\n\t\tglobalThis = globalThis.parent.self;\n\t\tlet rewrites = searchFrame(globalThis);\n\t\tif (rewrites) return rewrites;\n\t}\n}\n\nfunction registerRewrites(buf: Array<number>, tag: string) {\n\tconst sourcemap = Uint8Array.from(buf);\n\tconst view = new DataView(sourcemap.buffer);\n\tconst decoder = new TextDecoder(\"utf-8\");\n\n\tconst rewrites: Rewrite[] = [];\n\n\tconst rewritelen = view.getUint32(0, true);\n\tlet cursor = 4;\n\tfor (let i = 0; i < rewritelen; i++) {\n\t\tconst type = view.getUint8(cursor) as RewriteType;\n\t\tcursor += 1;\n\n\t\tif (type == RewriteType.Insert) {\n\t\t\tconst start = view.getUint32(cursor, true);\n\t\t\tcursor += 4;\n\t\t\tconst size = view.getUint32(cursor, true);\n\t\t\tcursor += 4;\n\n\t\t\trewrites.push({ type, start, size });\n\t\t} else if (type == RewriteType.Replace) {\n\t\t\tconst start = view.getUint32(cursor, true);\n\t\t\tcursor += 4;\n\t\t\tconst end = view.getUint32(cursor, true);\n\t\t\tcursor += 4;\n\t\t\tconst len = view.getUint32(cursor, true);\n\t\t\tcursor += 4;\n\n\t\t\tconst str = decoder.decode(sourcemap.subarray(cursor, cursor + len));\n\n\t\t\trewrites.push({ type, start, end, str });\n\t\t}\n\t}\n\n\tself[SCRAMJETCLIENT].sourcemaps[tag] = rewrites;\n}\n\nfunction doUnrewrite(ctx: ProxyCtx) {\n\tlet stringified: string = ctx.fn.call(ctx.this);\n\n\t// every function rewritten will have a scramtag comment\n\t// it will look like this:\n\t// function name() /*scramtag [index] [tag] */ { ... }\n\tconst scramtagstart = stringified.indexOf(\"/*s\");\n\n\tif (scramtagstart === -1) return ctx.return(stringified); // it's either a native function or something stolen from scramjet itself\n\n\tconst firstspace = stringified.indexOf(\n\t\t\" \",\n\t\tscramtagstart + scramtag_ident.length\n\t);\n\t// [index] holds the index of the first character in the scramtag (/)\n\tconst abstagindex = parseInt(\n\t\tstringified.substring(scramtagstart + scramtag_ident.length, firstspace)\n\t);\n\n\t// subtracting that from the index of the scramtag gives us the starting index of the function relative to the entire file\n\tconst absindex = abstagindex - scramtagstart;\n\tconst endindex = absindex + stringified.length;\n\n\tconst scramtagend = stringified.indexOf(\"*/\", scramtagstart);\n\tconst tag = stringified.substring(firstspace + 1, scramtagend);\n\n\tconst rewrites = searchRewrites(tag);\n\n\tif (!rewrites) {\n\t\tconsole.warn(\"failed to get rewrites for tag\", tag);\n\n\t\treturn ctx.return(stringified);\n\t}\n\n\tlet i = 0;\n\t// skip all rewrites in the file before the fn\n\twhile (i < rewrites.length) {\n\t\tif (rewrites[i].start < absindex) i++;\n\t\telse break;\n\t}\n\n\tlet end = i;\n\twhile (end < rewrites.length) {\n\t\tif (getEnd(rewrites[end]) < endindex) end++;\n\t\telse break;\n\t}\n\n\tconst fnrewrites = rewrites.slice(i, end);\n\n\tlet newString = \"\";\n\tlet lastpos = absindex;\n\n\tfor (const rewrite of fnrewrites) {\n\t\tnewString += stringified.slice(lastpos, rewrite.start);\n\n\t\tif (rewrite.type === RewriteType.Insert) {\n\t\t\tlastpos = rewrite.start + rewrite.size;\n\t\t} else if (rewrite.type === RewriteType.Replace) {\n\t\t\tnewString += rewrite.str;\n\t\t\tlastpos = rewrite.end;\n\t\t} else {\n\t\t\tthrow \"unreachable\";\n\t\t}\n\t}\n\n\tnewString += stringified.slice(lastpos);\n\n\treturn ctx.return(newString);\n}\n\nexport const enabled = (client: ScramjetClient) =>\n\tflagEnabled(\"sourcemaps\", client.url);\n\nexport default function (client: ScramjetClient, self: Self) {\n\t// every script will push a sourcemap\n\tObject.defineProperty(\n\t\tself,\n\t\tglobalThis.$scramjet.config.globals.pushsourcemapfn,\n\t\t{\n\t\t\tvalue: (buf: Array<number>, tag: string) => {\n\t\t\t\tconst before = performance.now();\n\t\t\t\tregisterRewrites(buf, tag);\n\t\t\t\tconst after = performance.now();\n\n\t\t\t\tconst duration = after - before;\n\n\t\t\t\tif (flagEnabled(\"rewriterLogs\", new URL(location.href))) {\n\t\t\t\t\tlet timespan: string;\n\t\t\t\t\tif (duration < 1) {\n\t\t\t\t\t\ttimespan = \"BLAZINGLY FAST\";\n\t\t\t\t\t} else if (duration < 500) {\n\t\t\t\t\t\ttimespan = \"decent speed\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttimespan = \"really slow\";\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t`js rewrite parsing for scramtag ${tag} was ${timespan} (${duration.toFixed(2)}ms)`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t},\n\t\t\tenumerable: false,\n\t\t\twritable: false,\n\t\t\tconfigurable: false,\n\t\t}\n\t);\n\n\t// when we rewrite javascript it will make function.toString leak internals\n\t// this can lead to double rewrites which is bad\n\tclient.Proxy(\"Function.prototype.toString\", {\n\t\tapply(ctx) {\n\t\t\tconst before = performance.now();\n\t\t\tdoUnrewrite(ctx);\n\t\t\tconst after = performance.now();\n\n\t\t\tconst duration = after - before;\n\n\t\t\tif (flagEnabled(\"rewriterLogs\", new URL(location.href))) {\n\t\t\t\tlet timespan: string;\n\t\t\t\tif (duration < 1) {\n\t\t\t\t\ttimespan = \"BLAZINGLY FAST\";\n\t\t\t\t} else if (duration < 500) {\n\t\t\t\t\ttimespan = \"decent speed\";\n\t\t\t\t} else {\n\t\t\t\t\ttimespan = \"really slow\";\n\t\t\t\t}\n\t\t\t\tconsole.log(\n\t\t\t\t\t`js unrewrite for function was ${timespan} (${duration.toFixed(2)}ms)`\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t});\n}\n","export default function (client, self) {\n\tdelete self.TrustedHTML;\n\tdelete self.TrustedScript;\n\tdelete self.TrustedScriptURL;\n\tdelete self.TrustedTypePolicy;\n\tdelete self.TrustedTypePolicyFactory;\n\tself.__defineGetter__(\"trustedTypes\", () => undefined);\n}\n","import { iswindow } from \"..\";\nimport { ProxyCtx, ScramjetClient } from \"../client\";\n\n// we don't want to end up overriding a property on window that's derived from a prototype until we've proxied the prototype\nexport const order = 3;\n\nexport default function (client: ScramjetClient, self: typeof window) {\n\t// an automated approach to cleaning the documentProxy from dom functions\n\t// it will trigger an illegal invocation if you pass the proxy to c++ code, we gotta hotswap it out with the real one\n\t// admittedly this is pretty slow. worth investigating if there's ways to get back some of the lost performance\n\n\tfor (const target of [self]) {\n\t\tfor (const prop in target) {\n\t\t\ttry {\n\t\t\t\tif (typeof target[prop] === \"function\") {\n\t\t\t\t\tclient.RawProxy(target, prop, {\n\t\t\t\t\t\tapply(ctx) {\n\t\t\t\t\t\t\tunproxy(ctx, client);\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch {}\n\t\t}\n\t}\n\n\tif (!iswindow) return;\n\n\tfor (const target of [\n\t\tself.Node.prototype,\n\t\tself.MutationObserver.prototype,\n\t\tself.document,\n\t\tself.MouseEvent.prototype,\n\t\tself.Range.prototype,\n\t]) {\n\t\tfor (const prop in target) {\n\t\t\ttry {\n\t\t\t\tif (typeof target[prop] === \"function\") {\n\t\t\t\t\tclient.RawProxy(target, prop, {\n\t\t\t\t\t\tapply(ctx) {\n\t\t\t\t\t\t\tunproxy(ctx, client);\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch {}\n\t\t}\n\t}\n\n\tclient.Proxy(\"IntersectionObserver\", {\n\t\tconstruct(ctx) {\n\t\t\tif (ctx.args[1] && ctx.args[1].root) ctx.args[1].root = self.document;\n\t\t},\n\t});\n\n\t// this is probably not how stuff should be done but you cant run defineProperty on the window proxy so...\n\tclient.Proxy(\"Object.defineProperty\", {\n\t\tapply(ctx) {\n\t\t\tunproxy(ctx, client);\n\t\t},\n\t});\n\n\tclient.Proxy(\"Object.getOwnPropertyDescriptor\", {\n\t\tapply(ctx) {\n\t\t\tconst desc = ctx.call();\n\n\t\t\tif (!desc) return;\n\n\t\t\tif (desc.get) {\n\t\t\t\tclient.RawProxy(desc, \"get\", {\n\t\t\t\t\tapply(getCtx) {\n\t\t\t\t\t\t// value of this in the getter needs to be corrected\n\t\t\t\t\t\tunproxy(getCtx, client);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (desc.set) {\n\t\t\t\tclient.RawProxy(desc, \"set\", {\n\t\t\t\t\tapply(setCtx) {\n\t\t\t\t\t\tunproxy(setCtx, client);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// i don't think we have to care about value but it's worth looking into\n\n\t\t\tctx.return(desc);\n\t\t},\n\t});\n}\n\nexport function unproxy(ctx: ProxyCtx, client: ScramjetClient) {\n\tconst self = client.global;\n\tif (ctx.this === client.globalProxy) ctx.this = self;\n\tif (ctx.this === client.documentProxy) ctx.this = self.document;\n\n\tfor (const i in ctx.args) {\n\t\tif (ctx.args[i] === client.documentProxy) ctx.args[i] = self.document;\n\t\tif (ctx.args[i] === client.globalProxy) ctx.args[i] = self;\n\t}\n}\n","import { BareMuxConnection } from \"../../shared\";\nimport { rewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, _self: typeof globalThis) {\n\tclient.Proxy(\"Worker\", {\n\t\tconstruct({ args, call }) {\n\t\t\targs[0] = rewriteUrl(args[0], client.meta) + \"?dest=worker\";\n\n\t\t\tif (args[1] && args[1].type === \"module\") {\n\t\t\t\targs[0] += \"&type=module\";\n\t\t\t}\n\n\t\t\tconst worker = call();\n\t\t\tconst conn = new BareMuxConnection();\n\n\t\t\t(async () => {\n\t\t\t\tconst port = await conn.getInnerPort();\n\t\t\t\tclient.natives.call(\n\t\t\t\t\t\"Worker.prototype.postMessage\",\n\t\t\t\t\tworker,\n\t\t\t\t\t{\n\t\t\t\t\t\t$scramjet$type: \"baremuxinit\",\n\t\t\t\t\t\tport,\n\t\t\t\t\t},\n\t\t\t\t\t[port]\n\t\t\t\t);\n\t\t\t})();\n\t\t},\n\t});\n\n\t// sharedworkers can only be constructed from window\n\tclient.Proxy(\"SharedWorker\", {\n\t\tconstruct({ args, call }) {\n\t\t\targs[0] = rewriteUrl(args[0], client.meta) + \"?dest=sharedworker\";\n\n\t\t\tif (args[1] && typeof args[1] === \"string\")\n\t\t\t\targs[1] = `${client.url.origin}@${args[1]}`;\n\n\t\t\tif (args[1] && typeof args[1] === \"object\") {\n\t\t\t\tif (args[1].type === \"module\") {\n\t\t\t\t\targs[0] += \"&type=module\";\n\t\t\t\t}\n\n\t\t\t\tif (args[1].name) {\n\t\t\t\t\targs[1].name = `${client.url.origin}@${args[1].name}`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst worker = call();\n\t\t\tconst conn = new BareMuxConnection();\n\n\t\t\t(async () => {\n\t\t\t\tconst port = await conn.getInnerPort();\n\t\t\t\tclient.natives.call(\n\t\t\t\t\t\"MessagePort.prototype.postMessage\",\n\t\t\t\t\tworker.port,\n\t\t\t\t\t{\n\t\t\t\t\t\t$scramjet$type: \"baremuxinit\",\n\t\t\t\t\t\tport,\n\t\t\t\t\t},\n\t\t\t\t\t[port]\n\t\t\t\t);\n\t\t\t})();\n\t\t},\n\t});\n\n\tclient.Proxy(\"Worklet.prototype.addModule\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0])\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta) + \"?dest=worklet\";\n\t\t},\n\t});\n}\n","import { iswindow } from \"..\";\nimport { SCRAMJETCLIENT } from \"../../symbols\";\nimport { ScramjetClient } from \"../client\";\nimport { config } from \"../../shared\";\n// import { argdbg } from \"./err\";\nimport { indirectEval } from \"./eval\";\n\nexport function createWrapFn(client: ScramjetClient, self: typeof globalThis) {\n\treturn function (identifier: any, strict: boolean) {\n\t\tif (identifier === self) return client.globalProxy;\n\t\tif (identifier === self.location) return client.locationProxy;\n\t\tif (identifier === eval) return indirectEval.bind(client, strict);\n\n\t\tif (iswindow) {\n\t\t\tif (identifier === self.parent) {\n\t\t\t\tif (SCRAMJETCLIENT in self.parent) {\n\t\t\t\t\t// ... then we're in a subframe, and the parent frame is also in a proxy context, so we should return its proxy\n\t\t\t\t\treturn self.parent[SCRAMJETCLIENT].globalProxy;\n\t\t\t\t} else {\n\t\t\t\t\t// ... then we should pretend we aren't nested and return the current window\n\t\t\t\t\treturn client.globalProxy;\n\t\t\t\t}\n\t\t\t} else if (identifier === self.document) {\n\t\t\t\treturn client.documentProxy;\n\t\t\t} else if (identifier === self.top) {\n\t\t\t\t// instead of returning top, we need to return the uppermost parent that's inside a scramjet context\n\t\t\t\tlet current = self;\n\n\t\t\t\tfor (;;) {\n\t\t\t\t\tconst test = current.parent.self;\n\t\t\t\t\tif (test === current) break; // there is no parent, actual or emulated.\n\n\t\t\t\t\t// ... then `test` represents a window outside of the proxy context, and therefore `current` is the topmost window in the proxy context\n\t\t\t\t\tif (!(SCRAMJETCLIENT in test)) break;\n\n\t\t\t\t\t// test is also insde a proxy, so we should continue up the chain\n\t\t\t\t\tcurrent = test;\n\t\t\t\t}\n\n\t\t\t\treturn current[SCRAMJETCLIENT].globalProxy;\n\t\t\t}\n\t\t}\n\n\t\treturn identifier;\n\t};\n}\n\nexport const order = 4;\nexport default function (client: ScramjetClient, self: typeof globalThis) {\n\t// the main magic of the proxy. all attempts to access any \"banned objects\" will be redirected here, and instead served a proxy object\n\t// this contrasts from how other proxies will leave the root object alone and instead attempt to catch every member access\n\t// this presents some issues (see element.ts), but makes us a good bit faster at runtime!\n\tObject.defineProperty(self, config.globals.wrapfn, {\n\t\tvalue: client.wrapfn,\n\t\twritable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(self, config.globals.wrapthisfn, {\n\t\tvalue: function (i) {\n\t\t\tif (i === self) return client.globalProxy;\n\n\t\t\treturn i;\n\t\t},\n\t\twritable: false,\n\t\tconfigurable: false,\n\t});\n\n\tself.$scramitize = function (v) {\n\t\tif (v === self) debugger;\n\t\tif (v === location) debugger;\n\t\tif (iswindow) {\n\t\t\tif (v === self.parent) debugger;\n\t\t\tif (v === self.document) debugger;\n\t\t\tif (v === self.top) debugger;\n\t\t}\n\n\t\tif (typeof v === \"string\" && v.includes(\"scramjet\")) debugger;\n\t\tif (typeof v === \"string\" && v.includes(location.origin)) debugger;\n\n\t\treturn v;\n\t};\n\n\t// location = \"...\" can't be rewritten as wrapfn(location) = ..., so instead it will actually be rewritten as\n\t// ((t)=>$scramjet$tryset(location,\"+=\",t)||location+=t)(...);\n\t// it has to be a discrete function because there's always the possibility that \"location\" is a local variable\n\t// we have to use an IIFE to avoid duplicating side-effects in the getter\n\tObject.defineProperty(self, config.globals.trysetfn, {\n\t\tvalue: function (lhs: any, op: string, rhs: any) {\n\t\t\tif (lhs instanceof Location) {\n\t\t\t\t// @ts-ignore\n\t\t\t\tlocationProxy.href = rhs;\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\twritable: false,\n\t\tconfigurable: false,\n\t});\n}\n","import { ScramjetClient } from \"./client\";\nimport { unrewriteUrl } from \"../shared\";\n\nexport class ScramjetServiceWorkerRuntime {\n\trecvport: MessagePort;\n\tconstructor(public client: ScramjetClient) {\n\t\t// @ts-ignore\n\t\tself.onconnect = (cevent: MessageEvent) => {\n\t\t\tconst port = cevent.ports[0];\n\t\t\tdbg.log(\"sw\", \"connected\");\n\n\t\t\tport.addEventListener(\"message\", (event) => {\n\t\t\t\tconsole.log(\"sw\", event.data);\n\t\t\t\tif (\"scramjet$type\" in event.data) {\n\t\t\t\t\tif (event.data.scramjet$type === \"init\") {\n\t\t\t\t\t\tthis.recvport = event.data.scramjet$port;\n\t\t\t\t\t\tthis.recvport.postMessage({ scramjet$type: \"init\" });\n\t\t\t\t\t} else {\n\t\t\t\t\t\thandleMessage.call(this, client, event.data);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tport.start();\n\t\t};\n\t}\n\n\thook() {\n\t\t// @ts-expect-error TODO\n\t\tthis.client.global.registration = {\n\t\t\t// TODO IMPLEMENT SCOPES\n\t\t\tscope: this.client.url.href,\n\t\t\tactive: {\n\t\t\t\tscriptURL: this.client.url.href,\n\t\t\t\tstate: \"activated\",\n\t\t\t\tonstatechange: null,\n\t\t\t\tonerror: null,\n\n\t\t\t\tpostMessage: () => {},\n\t\t\t\taddEventListener: () => {},\n\t\t\t\tremoveEventListener: () => {},\n\t\t\t\tdispatchEvent: (_e: Event): boolean => {\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t},\n\t\t\tshowNotification: async () => {},\n\t\t\tunregister: async () => true,\n\t\t\tupdate: async () => {},\n\t\t\tinstalling: null,\n\t\t\twaiting: null,\n\t\t};\n\n\t\t// @ts-ignore\n\t\tthis.client.global.ServiceWorkerGlobalScope = this.client.global;\n\t}\n}\n\nfunction handleMessage(\n\tthis: ScramjetServiceWorkerRuntime,\n\tclient: ScramjetClient,\n\tdata: MessageW2R\n) {\n\tconst port = this.recvport;\n\tconst type = data.scramjet$type;\n\tconst token = data.scramjet$token;\n\tconst handlers = client.eventcallbacks.get(self);\n\n\tif (type === \"fetch\") {\n\t\tdbg.log(\"ee\", data);\n\t\tconst fetchhandlers = handlers.filter((event) => event.event === \"fetch\");\n\t\tif (!fetchhandlers) return;\n\n\t\tfor (const handler of fetchhandlers) {\n\t\t\tconst request = data.scramjet$request;\n\n\t\t\tconst Request = client.natives[\"Request\"];\n\t\t\tconst fakeRequest = new Request(unrewriteUrl(request.url), {\n\t\t\t\tbody: request.body,\n\t\t\t\theaders: new Headers(request.headers),\n\t\t\t\tmethod: request.method,\n\t\t\t\tmode: \"same-origin\",\n\t\t\t});\n\n\t\t\tObject.defineProperty(fakeRequest, \"destination\", {\n\t\t\t\tvalue: request.destinitation,\n\t\t\t});\n\n\t\t\t// TODO: clean up, maybe put into a class\n\t\t\tconst fakeFetchEvent: any = new Event(\"fetch\");\n\t\t\tfakeFetchEvent.request = fakeRequest;\n\t\t\tlet responded = false;\n\t\t\tfakeFetchEvent.respondWith = (response: Response | Promise<Response>) => {\n\t\t\t\tresponded = true;\n\t\t\t\t(async () => {\n\t\t\t\t\tresponse = await response;\n\t\t\t\t\tconst message: MessageR2W = {\n\t\t\t\t\t\tscramjet$type: \"fetch\",\n\t\t\t\t\t\tscramjet$token: token,\n\t\t\t\t\t\tscramjet$response: {\n\t\t\t\t\t\t\tbody: response.body,\n\t\t\t\t\t\t\theaders: Array.from(response.headers.entries()),\n\t\t\t\t\t\t\tstatus: response.status,\n\t\t\t\t\t\t\tstatusText: response.statusText,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\n\t\t\t\t\tdbg.log(\"sw\", \"responding\", message);\n\t\t\t\t\tport.postMessage(message, [response.body]);\n\t\t\t\t})();\n\t\t\t};\n\n\t\t\tdbg.log(\"to fn\", fakeFetchEvent);\n\t\t\thandler.proxiedCallback(trustEvent(fakeFetchEvent));\n\t\t\tif (!responded) {\n\t\t\t\tconsole.log(\"sw\", \"no response\");\n\t\t\t\tport.postMessage({\n\t\t\t\t\tscramjet$type: \"fetch\",\n\t\t\t\t\tscramjet$token: token,\n\t\t\t\t\tscramjet$response: false,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction trustEvent(event: Event): Event {\n\treturn new Proxy(event, {\n\t\tget(target, prop, _reciever) {\n\t\t\tif (prop === \"isTrusted\") return true;\n\n\t\t\treturn Reflect.get(target, prop);\n\t\t},\n\t});\n}\n\nexport type TransferrableResponse = {\n\tbody: ReadableStream;\n\theaders: [string, string][];\n\tstatus: number;\n\tstatusText: string;\n};\n\nexport type TransferrableRequest = {\n\tbody: ReadableStream;\n\theaders: [string, string][];\n\tdestinitation: RequestDestination;\n\tmethod: Request[\"method\"];\n\tmode: Request[\"mode\"];\n\turl: string;\n};\n\ntype FetchResponseMessage = {\n\tscramjet$type: \"fetch\";\n\tscramjet$response: TransferrableResponse;\n};\n\ntype FetchRequestMessage = {\n\tscramjet$type: \"fetch\";\n\tscramjet$request: TransferrableRequest;\n};\n\n// r2w = runtime to (service) worker\n\ntype MessageTypeR2W = FetchResponseMessage;\ntype MessageTypeW2R = FetchRequestMessage;\n\ntype MessageCommon = {\n\tscramjet$type: string;\n\tscramjet$token: number;\n};\n\nexport type MessageR2W = MessageCommon & MessageTypeR2W;\nexport type MessageW2R = MessageCommon &\n\tMessageTypeW2R & { scramjet$port?: MessagePort };\n","import { rewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tclient.Proxy(\"importScripts\", {\n\t\tapply(ctx) {\n\t\t\tfor (const i in ctx.args) {\n\t\t\t\tctx.args[i] = rewriteUrl(ctx.args[i], client.meta);\n\t\t\t}\n\t\t},\n\t});\n}\n","export default {\n\tfmt: function (severity: string, message: string, ...args: any[]) {\n\t\tconst old = Error.prepareStackTrace;\n\n\t\tError.prepareStackTrace = (_, stack) => {\n\t\t\tstack.shift(); // stack();\n\t\t\tstack.shift(); // fmt();\n\t\t\tstack.shift();\n\n\t\t\tlet fmt = \"\";\n\t\t\tfor (let i = 1; i < Math.min(2, stack.length); i++) {\n\t\t\t\tif (stack[i].getFunctionName()) {\n\t\t\t\t\t// const f = stack[i].getThis()?.constructor?.name;\n\t\t\t\t\t// if (f) fmt += `${f}.`\n\t\t\t\t\tfmt += `${stack[i].getFunctionName()} -> ` + fmt;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfmt += stack[0].getFunctionName() || \"Anonymous\";\n\n\t\t\treturn fmt;\n\t\t};\n\n\t\tconst fmt = (function stack() {\n\t\t\ttry {\n\t\t\t\tthrow new Error();\n\t\t\t} catch (e) {\n\t\t\t\treturn e.stack;\n\t\t\t}\n\t\t})();\n\n\t\tError.prepareStackTrace = old;\n\n\t\tconst fn = console[severity] || console.log;\n\t\tconst bg = {\n\t\t\tlog: \"#000\",\n\t\t\twarn: \"#f80\",\n\t\t\terror: \"#f00\",\n\t\t\tdebug: \"transparent\",\n\t\t}[severity];\n\t\tconst fg = {\n\t\t\tlog: \"#fff\",\n\t\t\twarn: \"#fff\",\n\t\t\terror: \"#fff\",\n\t\t\tdebug: \"gray\",\n\t\t}[severity];\n\t\tconst padding = {\n\t\t\tlog: 2,\n\t\t\twarn: 4,\n\t\t\terror: 4,\n\t\t\tdebug: 0,\n\t\t}[severity];\n\n\t\tfn(\n\t\t\t`%c${fmt}%c ${message}`,\n\t\t\t`\n\t\tbackground-color: ${bg};\n\t\tcolor: ${fg};\n\t\tpadding: ${padding}px;\n\t\tfont-weight: bold;\n\t\tfont-family: monospace;\n\t\tfont-size: 0.9em;\n\t`,\n\t\t\t`${severity === \"debug\" ? \"color: gray\" : \"\"}`,\n\t\t\t...args\n\t\t);\n\t},\n\tlog: function (message: string, ...args: any[]) {\n\t\tthis.fmt(\"log\", message, ...args);\n\t},\n\twarn: function (message: string, ...args: any[]) {\n\t\tthis.fmt(\"warn\", message, ...args);\n\t},\n\terror: function (message: string, ...args: any[]) {\n\t\tthis.fmt(\"error\", message, ...args);\n\t},\n\tdebug: function (message: string, ...args: any[]) {\n\t\tthis.fmt(\"debug\", message, ...args);\n\t},\n};\n","import { ScramjetFlags } from \"./types\";\n\nif (!(\"$scramjet\" in self)) {\n\t// @ts-expect-error ts stuff\n\tself.$scramjet = {\n\t\tversion: {\n\t\t\tbuild: COMMITHASH,\n\t\t\tversion: VERSION,\n\t\t},\n\t\tcodec: {},\n\t\tflagEnabled,\n\t};\n}\n\nexport const $scramjet = self.$scramjet;\n\nconst nativeFunction = Function;\nexport function loadCodecs() {\n\t$scramjet.codec.encode = nativeFunction(\n\t\t\"url\",\n\t\t$scramjet.config.codec.encode\n\t) as any;\n\t$scramjet.codec.decode = nativeFunction(\n\t\t\"url\",\n\t\t$scramjet.config.codec.decode\n\t) as any;\n}\n\nexport function flagEnabled(flag: keyof ScramjetFlags, url: URL): boolean {\n\tconst value = $scramjet.config.flags[flag];\n\tfor (const regex in $scramjet.config.siteFlags) {\n\t\tconst partialflags = $scramjet.config.siteFlags[regex];\n\t\tif (new RegExp(regex).test(url.href) && flag in partialflags) {\n\t\t\treturn partialflags[flag];\n\t\t}\n\t}\n\n\treturn value;\n}\n","import { $scramjet } from \"./scramjet\";\n\nexport const {\n\tutil: { BareClient, ScramjetHeaders, BareMuxConnection },\n\turl: { rewriteUrl, unrewriteUrl, rewriteBlob, unrewriteBlob },\n\trewrite: {\n\t\trewriteCss,\n\t\tunrewriteCss,\n\t\trewriteHtml,\n\t\tunrewriteHtml,\n\t\trewriteSrcset,\n\t\trewriteJs,\n\t\trewriteHeaders,\n\t\trewriteWorkers,\n\t\thtmlRules,\n\t},\n\tCookieStore,\n} = $scramjet.shared;\n\nexport const config = $scramjet.config;\n","import { URLMeta } from \"./url\";\n\n// i am a cat. i like to be petted. i like to be fed. i like to be\nimport {\n\tinitSync,\n\trewrite_js,\n\trewrite_js_from_arraybuffer,\n\tRewriterOutput,\n} from \"../../../rewriter/wasm/out/wasm.js\";\nimport { $scramjet, flagEnabled } from \"../../scramjet\";\n\nif (self.WASM)\n\tself.REAL_WASM = Uint8Array.from(atob(self.WASM), (c) => c.charCodeAt(0));\n\n// only use in sw\nexport async function asyncInitRewriter() {\n\tconst buf = await fetch($scramjet.config.files.wasm).then((r) =>\n\t\tr.arrayBuffer()\n\t);\n\tself.REAL_WASM = new Uint8Array(buf);\n}\n\nError.stackTraceLimit = 50;\n\nconst decoder = new TextDecoder();\n\nfunction rewriteJsWasm(\n\tinput: string | Uint8Array,\n\tsource: string | null,\n\tmeta: URLMeta,\n\tmodule: boolean\n): { js: string | Uint8Array; map: Uint8Array | null; tag: string } {\n\tinitSync({\n\t\tmodule: new WebAssembly.Module(self.REAL_WASM),\n\t});\n\n\tlet out: RewriterOutput;\n\tconst before = performance.now();\n\ttry {\n\t\tif (typeof input === \"string\") {\n\t\t\tout = rewrite_js(\n\t\t\t\tinput,\n\t\t\t\tmeta.base.href,\n\t\t\t\tsource || \"(unknown)\",\n\t\t\t\tmodule,\n\t\t\t\t$scramjet\n\t\t\t);\n\t\t} else {\n\t\t\tout = rewrite_js_from_arraybuffer(\n\t\t\t\tinput,\n\t\t\t\tmeta.base.href,\n\t\t\t\tsource || \"(unknown)\",\n\t\t\t\tmodule,\n\t\t\t\t$scramjet\n\t\t\t);\n\t\t}\n\t} catch (err) {\n\t\tconst err1 = err as Error;\n\t\tconsole.warn(\"failed rewriting js for\", source, err1.message, input);\n\n\t\treturn { js: input, tag: \"\", map: null };\n\t}\n\tconst after = performance.now();\n\tlet { js, map, scramtag, errors, duration } = out;\n\n\tif (flagEnabled(\"sourcemaps\", meta.base) && !globalThis.clients) {\n\t\tglobalThis[globalThis.$scramjet.config.globals.pushsourcemapfn](\n\t\t\tArray.from(map),\n\t\t\tscramtag\n\t\t);\n\n\t\tmap = null;\n\t}\n\n\tif (flagEnabled(\"rewriterLogs\", meta.base)) {\n\t\tfor (const error of errors) {\n\t\t\tconsole.error(\"oxc parse error\", error);\n\t\t}\n\t}\n\n\tif (flagEnabled(\"rewriterLogs\", meta.base)) {\n\t\tlet timespan: string;\n\t\tif (duration < 1n) {\n\t\t\ttimespan = \"BLAZINGLY FAST\";\n\t\t} else if (duration < 500n) {\n\t\t\ttimespan = \"decent speed\";\n\t\t} else {\n\t\t\ttimespan = \"really slow\";\n\t\t}\n\t\tconst overhead = (after - before - Number(duration)).toFixed(2);\n\t\tconsole.log(\n\t\t\t`oxc rewrite for \"${source || \"(unknown)\"}\" was ${timespan} (${duration}ms; ${overhead}ms overhead)`\n\t\t);\n\t}\n\n\treturn {\n\t\tjs: typeof input === \"string\" ? decoder.decode(js) : js,\n\t\ttag: scramtag,\n\t\tmap,\n\t};\n}\n\n// 1. does not work with modules\n// 2. cannot proxy import()\n// 3. disables \"use strict\" optimizations\n// 4. i think the global state can get clobbered somehow\n//\n// if you can ensure all the preconditions are met this is faster than full rewrites\nfunction rewriteJsNaiive(js: string | ArrayBuffer) {\n\tif (typeof js !== \"string\") {\n\t\tjs = new TextDecoder().decode(js);\n\t}\n\n\treturn `\n\t\twith (${$scramjet.config.globals.wrapfn}(globalThis)) {\n\n\t\t\t${js}\n\n\t\t}\n\t`;\n}\n\nfunction rewriteJsInner(\n\tjs: string | Uint8Array,\n\turl: string | null,\n\tmeta: URLMeta,\n\tmodule = false\n) {\n\tif (flagEnabled(\"naiiveRewriter\", meta.origin)) {\n\t\tconst text = typeof js === \"string\" ? js : new TextDecoder().decode(js);\n\n\t\treturn { js: rewriteJsNaiive(text), tag: \"\", map: null };\n\t}\n\n\treturn rewriteJsWasm(js, url, meta, module);\n}\n\nexport function rewriteJs(\n\tjs: string | Uint8Array,\n\turl: string | null,\n\tmeta: URLMeta,\n\tmodule = false\n) {\n\treturn rewriteJsInner(js, url, meta, module).js;\n}\n\nexport function rewriteJsWithMap(\n\tjs: string | Uint8Array,\n\turl: string | null,\n\tmeta: URLMeta,\n\tmodule = false\n) {\n\treturn rewriteJsInner(js, url, meta, module);\n}\n","import { $scramjet } from \"../../scramjet\";\nimport { rewriteJs } from \"./js\";\n\nexport type URLMeta = {\n\torigin: URL;\n\tbase: URL;\n};\n\nfunction tryCanParseURL(url: string, origin?: string | URL): URL | null {\n\ttry {\n\t\treturn new URL(url, origin);\n\t} catch {\n\t\treturn null;\n\t}\n}\n\nexport function rewriteBlob(url: string, meta: URLMeta) {\n\tconst blob = new URL(url.substring(\"blob:\".length));\n\n\treturn \"blob:\" + meta.origin.origin + blob.pathname;\n}\n\nexport function unrewriteBlob(url: string) {\n\tconst blob = new URL(url.substring(\"blob:\".length));\n\n\treturn \"blob:\" + location.origin + blob.pathname;\n}\n\nexport function rewriteUrl(url: string | URL, meta: URLMeta) {\n\tif (url instanceof URL) url = url.toString();\n\n\tif (url.startsWith(\"javascript:\")) {\n\t\treturn (\n\t\t\t\"javascript:\" +\n\t\t\trewriteJs(url.slice(\"javascript:\".length), \"(javascript: url)\", meta)\n\t\t);\n\t} else if (url.startsWith(\"blob:\")) {\n\t\treturn location.origin + $scramjet.config.prefix + url;\n\t} else if (url.startsWith(\"data:\")) {\n\t\treturn location.origin + $scramjet.config.prefix + url;\n\t} else if (url.startsWith(\"mailto:\") || url.startsWith(\"about:\")) {\n\t\treturn url;\n\t} else {\n\t\tlet base = meta.base.href;\n\n\t\tif (base.startsWith(\"about:\")) base = unrewriteUrl(self.location.href); // jank!!!!! weird jank!!!\n\t\tconst realUrl = tryCanParseURL(url, base);\n\t\tif (!realUrl) return url;\n\n\t\treturn (\n\t\t\tlocation.origin +\n\t\t\t$scramjet.config.prefix +\n\t\t\t$scramjet.codec.encode(realUrl.href)\n\t\t);\n\t}\n}\n\nexport function unrewriteUrl(url: string | URL) {\n\tif (url instanceof URL) url = url.toString();\n\n\tconst prefixed = location.origin + $scramjet.config.prefix;\n\n\tif (url.startsWith(\"javascript:\")) {\n\t\t//TODO\n\t\treturn url;\n\t} else if (url.startsWith(\"blob:\")) {\n\t\t// realistically this shouldn't happen\n\t\treturn url;\n\t} else if (url.startsWith(prefixed + \"blob:\")) {\n\t\treturn url.substring(prefixed.length);\n\t} else if (url.startsWith(prefixed + \"data:\")) {\n\t\treturn url.substring(prefixed.length);\n\t} else if (url.startsWith(\"mailto:\") || url.startsWith(\"about:\")) {\n\t\treturn url;\n\t} else if (tryCanParseURL(url)) {\n\t\treturn $scramjet.codec.decode(\n\t\t\turl.slice((location.origin + $scramjet.config.prefix).length)\n\t\t);\n\t} else {\n\t\treturn url;\n\t}\n}\n","// see types.d.ts for what these mean\nexport const SCRAMJETCLIENTNAME = \"scramjet client global\";\nexport const SCRAMJETCLIENT = Symbol.for(SCRAMJETCLIENTNAME);\nexport const SCRAMJETFRAME = Symbol.for(\"scramjet frame handle\");\n","\n// slightly modified https://github.com/ungap/random-uuid/blob/main/index.js\nexport function scramtag() {\n    return (\"\"+1e10).replace(/[018]/g,\n      c => (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\n    );\n}\n","import { scramtag } from './snippets/wasm-4b0f351a8e6eeb46/inline0.js';\n\nlet wasm;\n\nfunction addToExternrefTable0(obj) {\n    const idx = wasm.__externref_table_alloc();\n    wasm.__wbindgen_export_2.set(idx, obj);\n    return idx;\n}\n\nfunction handleError(f, args) {\n    try {\n        return f.apply(this, args);\n    } catch (e) {\n        const idx = addToExternrefTable0(e);\n        wasm.__wbindgen_exn_store(idx);\n    }\n}\n\nconst cachedTextDecoder = (typeof TextDecoder !== 'undefined' ? new TextDecoder('utf-8', { ignoreBOM: true, fatal: true }) : { decode: () => { throw Error('TextDecoder not available') } } );\n\nif (typeof TextDecoder !== 'undefined') { cachedTextDecoder.decode(); };\n\nlet cachedUint8ArrayMemory0 = null;\n\nfunction getUint8ArrayMemory0() {\n    if (cachedUint8ArrayMemory0 === null || cachedUint8ArrayMemory0.buffer !== wasm.memory.buffer) {\n        cachedUint8ArrayMemory0 = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachedUint8ArrayMemory0;\n}\n\nfunction getStringFromWasm0(ptr, len) {\n    ptr = ptr >>> 0;\n    return cachedTextDecoder.decode(getUint8ArrayMemory0().slice(ptr, ptr + len));\n}\n\nlet WASM_VECTOR_LEN = 0;\n\nconst cachedTextEncoder = (typeof TextEncoder !== 'undefined' ? new TextEncoder('utf-8') : { encode: () => { throw Error('TextEncoder not available') } } );\n\nconst encodeString = function (arg, view) {\n    const buf = cachedTextEncoder.encode(arg);\n    view.set(buf);\n    return {\n        read: arg.length,\n        written: buf.length\n    };\n};\n\nfunction passStringToWasm0(arg, malloc, realloc) {\n\n    if (realloc === undefined) {\n        const buf = cachedTextEncoder.encode(arg);\n        const ptr = malloc(buf.length, 1) >>> 0;\n        getUint8ArrayMemory0().subarray(ptr, ptr + buf.length).set(buf);\n        WASM_VECTOR_LEN = buf.length;\n        return ptr;\n    }\n\n    let len = arg.length;\n    let ptr = malloc(len, 1) >>> 0;\n\n    const mem = getUint8ArrayMemory0();\n\n    let offset = 0;\n\n    for (; offset < len; offset++) {\n        const code = arg.charCodeAt(offset);\n        if (code > 0x7F) break;\n        mem[ptr + offset] = code;\n    }\n\n    if (offset !== len) {\n        if (offset !== 0) {\n            arg = arg.slice(offset);\n        }\n        ptr = realloc(ptr, len, len = offset + arg.length * 3, 1) >>> 0;\n        const view = getUint8ArrayMemory0().subarray(ptr + offset, ptr + len);\n        const ret = encodeString(arg, view);\n\n        offset += ret.written;\n        ptr = realloc(ptr, len, offset, 1) >>> 0;\n    }\n\n    WASM_VECTOR_LEN = offset;\n    return ptr;\n}\n\nlet cachedDataViewMemory0 = null;\n\nfunction getDataViewMemory0() {\n    if (cachedDataViewMemory0 === null || cachedDataViewMemory0.buffer !== wasm.memory.buffer) {\n        cachedDataViewMemory0 = new DataView(wasm.memory.buffer);\n    }\n    return cachedDataViewMemory0;\n}\n\nfunction isLikeNone(x) {\n    return x === undefined || x === null;\n}\n\nfunction takeFromExternrefTable0(idx) {\n    const value = wasm.__wbindgen_export_2.get(idx);\n    wasm.__externref_table_dealloc(idx);\n    return value;\n}\n/**\n * @param {string} js\n * @param {string} url\n * @param {string} script_url\n * @param {boolean} module\n * @param {object} scramjet\n * @returns {RewriterOutput}\n */\nexport function rewrite_js(js, url, script_url, module, scramjet) {\n    const ptr0 = passStringToWasm0(js, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n    const len0 = WASM_VECTOR_LEN;\n    const ptr1 = passStringToWasm0(url, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n    const len1 = WASM_VECTOR_LEN;\n    const ptr2 = passStringToWasm0(script_url, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n    const len2 = WASM_VECTOR_LEN;\n    const ret = wasm.rewrite_js(ptr0, len0, ptr1, len1, ptr2, len2, module, scramjet);\n    if (ret[2]) {\n        throw takeFromExternrefTable0(ret[1]);\n    }\n    return takeFromExternrefTable0(ret[0]);\n}\n\nfunction passArray8ToWasm0(arg, malloc) {\n    const ptr = malloc(arg.length * 1, 1) >>> 0;\n    getUint8ArrayMemory0().set(arg, ptr / 1);\n    WASM_VECTOR_LEN = arg.length;\n    return ptr;\n}\n/**\n * @param {Uint8Array} js\n * @param {string} url\n * @param {string} script_url\n * @param {boolean} module\n * @param {object} scramjet\n * @returns {RewriterOutput}\n */\nexport function rewrite_js_from_arraybuffer(js, url, script_url, module, scramjet) {\n    const ptr0 = passArray8ToWasm0(js, wasm.__wbindgen_malloc);\n    const len0 = WASM_VECTOR_LEN;\n    const ptr1 = passStringToWasm0(url, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n    const len1 = WASM_VECTOR_LEN;\n    const ptr2 = passStringToWasm0(script_url, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n    const len2 = WASM_VECTOR_LEN;\n    const ret = wasm.rewrite_js_from_arraybuffer(ptr0, len0, ptr1, len1, ptr2, len2, module, scramjet);\n    if (ret[2]) {\n        throw takeFromExternrefTable0(ret[1]);\n    }\n    return takeFromExternrefTable0(ret[0]);\n}\n\nasync function __wbg_load(module, imports) {\n    if (typeof Response === 'function' && module instanceof Response) {\n        if (typeof WebAssembly.instantiateStreaming === 'function') {\n            try {\n                return await WebAssembly.instantiateStreaming(module, imports);\n\n            } catch (e) {\n                if (module.headers.get('Content-Type') != 'application/wasm') {\n                    console.warn(\"`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\\n\", e);\n\n                } else {\n                    throw e;\n                }\n            }\n        }\n\n        const bytes = await module.arrayBuffer();\n        return await WebAssembly.instantiate(bytes, imports);\n\n    } else {\n        const instance = await WebAssembly.instantiate(module, imports);\n\n        if (instance instanceof WebAssembly.Instance) {\n            return { instance, module };\n\n        } else {\n            return instance;\n        }\n    }\n}\n\nfunction __wbg_get_imports() {\n    const imports = {};\n    imports.wbg = {};\n    imports.wbg.__wbg_buffer_609cc3eee51ed158 = function(arg0) {\n        const ret = arg0.buffer;\n        return ret;\n    };\n    imports.wbg.__wbg_call_672a4d21634d4a24 = function() { return handleError(function (arg0, arg1) {\n        const ret = arg0.call(arg1);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_call_7cccdd69e0791ae2 = function() { return handleError(function (arg0, arg1, arg2) {\n        const ret = arg0.call(arg1, arg2);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_call_833bed5770ea2041 = function() { return handleError(function (arg0, arg1, arg2, arg3) {\n        const ret = arg0.call(arg1, arg2, arg3);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_get_67b2ba62fc30de12 = function() { return handleError(function (arg0, arg1) {\n        const ret = Reflect.get(arg0, arg1);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_new_405e22f390576ce2 = function() {\n        const ret = new Object();\n        return ret;\n    };\n    imports.wbg.__wbg_new_9ffbe0a71eff35e3 = function() { return handleError(function (arg0, arg1) {\n        const ret = new URL(getStringFromWasm0(arg0, arg1));\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_new_a12002a7f91c75be = function(arg0) {\n        const ret = new Uint8Array(arg0);\n        return ret;\n    };\n    imports.wbg.__wbg_newnoargs_105ed471475aaf50 = function(arg0, arg1) {\n        const ret = new Function(getStringFromWasm0(arg0, arg1));\n        return ret;\n    };\n    imports.wbg.__wbg_newwithbase_161c299e7a34e2eb = function() { return handleError(function (arg0, arg1, arg2, arg3) {\n        const ret = new URL(getStringFromWasm0(arg0, arg1), getStringFromWasm0(arg2, arg3));\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a = function(arg0, arg1, arg2) {\n        const ret = new Uint8Array(arg0, arg1 >>> 0, arg2 >>> 0);\n        return ret;\n    };\n    imports.wbg.__wbg_now_d18023d54d4e5500 = function(arg0) {\n        const ret = arg0.now();\n        return ret;\n    };\n    imports.wbg.__wbg_scramtag_3a255d78b157986d = function(arg0) {\n        const ret = scramtag();\n        const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbg_set_bb8cecf6a62b9f46 = function() { return handleError(function (arg0, arg1, arg2) {\n        const ret = Reflect.set(arg0, arg1, arg2);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07 = function() {\n        const ret = typeof global === 'undefined' ? null : global;\n        return isLikeNone(ret) ? 0 : addToExternrefTable0(ret);\n    };\n    imports.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0 = function() {\n        const ret = typeof globalThis === 'undefined' ? null : globalThis;\n        return isLikeNone(ret) ? 0 : addToExternrefTable0(ret);\n    };\n    imports.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819 = function() {\n        const ret = typeof self === 'undefined' ? null : self;\n        return isLikeNone(ret) ? 0 : addToExternrefTable0(ret);\n    };\n    imports.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40 = function() {\n        const ret = typeof window === 'undefined' ? null : window;\n        return isLikeNone(ret) ? 0 : addToExternrefTable0(ret);\n    };\n    imports.wbg.__wbg_toString_5285597960676b7b = function(arg0) {\n        const ret = arg0.toString();\n        return ret;\n    };\n    imports.wbg.__wbg_toString_c813bbd34d063839 = function(arg0) {\n        const ret = arg0.toString();\n        return ret;\n    };\n    imports.wbg.__wbindgen_array_new = function() {\n        const ret = [];\n        return ret;\n    };\n    imports.wbg.__wbindgen_array_push = function(arg0, arg1) {\n        arg0.push(arg1);\n    };\n    imports.wbg.__wbindgen_boolean_get = function(arg0) {\n        const v = arg0;\n        const ret = typeof(v) === 'boolean' ? (v ? 1 : 0) : 2;\n        return ret;\n    };\n    imports.wbg.__wbindgen_error_new = function(arg0, arg1) {\n        const ret = new Error(getStringFromWasm0(arg0, arg1));\n        return ret;\n    };\n    imports.wbg.__wbindgen_init_externref_table = function() {\n        const table = wasm.__wbindgen_export_2;\n        const offset = table.grow(4);\n        table.set(0, undefined);\n        table.set(offset + 0, undefined);\n        table.set(offset + 1, null);\n        table.set(offset + 2, true);\n        table.set(offset + 3, false);\n        ;\n    };\n    imports.wbg.__wbindgen_is_function = function(arg0) {\n        const ret = typeof(arg0) === 'function';\n        return ret;\n    };\n    imports.wbg.__wbindgen_is_undefined = function(arg0) {\n        const ret = arg0 === undefined;\n        return ret;\n    };\n    imports.wbg.__wbindgen_memory = function() {\n        const ret = wasm.memory;\n        return ret;\n    };\n    imports.wbg.__wbindgen_number_new = function(arg0) {\n        const ret = arg0;\n        return ret;\n    };\n    imports.wbg.__wbindgen_string_get = function(arg0, arg1) {\n        const obj = arg1;\n        const ret = typeof(obj) === 'string' ? obj : undefined;\n        var ptr1 = isLikeNone(ret) ? 0 : passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        var len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbindgen_string_new = function(arg0, arg1) {\n        const ret = getStringFromWasm0(arg0, arg1);\n        return ret;\n    };\n    imports.wbg.__wbindgen_throw = function(arg0, arg1) {\n        throw new Error(getStringFromWasm0(arg0, arg1));\n    };\n\n    return imports;\n}\n\nfunction __wbg_init_memory(imports, memory) {\n    imports.wbg.memory = memory || new WebAssembly.Memory({initial:19,maximum:16384,shared:true});\n}\n\nfunction __wbg_finalize_init(instance, module, thread_stack_size) {\n    wasm = instance.exports;\n    __wbg_init.__wbindgen_wasm_module = module;\n    cachedDataViewMemory0 = null;\n    cachedUint8ArrayMemory0 = null;\n\n    if (typeof thread_stack_size !== 'undefined' && (typeof thread_stack_size !== 'number' || thread_stack_size === 0 || thread_stack_size % 65536 !== 0)) { throw 'invalid stack size' }\n    wasm.__wbindgen_start(thread_stack_size);\n    return wasm;\n}\n\nfunction initSync(module, memory) {\n    if (wasm !== undefined) return wasm;\n\n    let thread_stack_size\n    if (typeof module !== 'undefined') {\n        if (Object.getPrototypeOf(module) === Object.prototype) {\n            ({module, memory, thread_stack_size} = module)\n        } else {\n            console.warn('using deprecated parameters for `initSync()`; pass a single object instead')\n        }\n    }\n\n    const imports = __wbg_get_imports();\n\n    __wbg_init_memory(imports, memory);\n\n    if (!(module instanceof WebAssembly.Module)) {\n        module = new WebAssembly.Module(module);\n    }\n\n    const instance = new WebAssembly.Instance(module, imports);\n\n    return __wbg_finalize_init(instance, module, thread_stack_size);\n}\n\nasync function __wbg_init(module_or_path, memory) {\n    if (wasm !== undefined) return wasm;\n\n    let thread_stack_size\n    if (typeof module_or_path !== 'undefined') {\n        if (Object.getPrototypeOf(module_or_path) === Object.prototype) {\n            ({module_or_path, memory, thread_stack_size} = module_or_path)\n        } else {\n            console.warn('using deprecated parameters for the initialization function; pass a single object instead')\n        }\n    }\n\n    if (typeof module_or_path === 'undefined') {\n        module_or_path = new URL('wasm_bg.wasm', \"\");\n    }\n    const imports = __wbg_get_imports();\n\n    if (typeof module_or_path === 'string' || (typeof Request === 'function' && module_or_path instanceof Request) || (typeof URL === 'function' && module_or_path instanceof URL)) {\n        module_or_path = fetch(module_or_path);\n    }\n\n    __wbg_init_memory(imports, memory);\n\n    const { instance, module } = await __wbg_load(await module_or_path, imports);\n\n    return __wbg_finalize_init(instance, module, thread_stack_size);\n}\n\nexport { initSync };\nexport default __wbg_init;\n"],"names":["iswindow","SCRAMJETCLIENT","SCRAMJETFRAME","createDocumentProxy","createGlobalProxy","getOwnPropertyDescriptorHandler","createLocationProxy","nativeGetOwnPropertyDescriptor","BareClient","CookieStore","config","unrewriteUrl","rewriteUrl","createWrapFn","NavigateEvent","ScramjetClient","global","Map","console","Error","Promise","resolve","addEventListener","data","Proxy","target","prop","split","realProp","realTarget","a","b","original","Reflect","args","that","value","client","base","url","frag","undefined","URL","frame","sframe","currentwin","cookiestr","context","modules","key","module","aorder","border","ev","name","handler","Array","n","h","constructor","newTarget","returnValue","earlyreturn","ctx","r","fn","pst","err","s","location","Object","descriptor","oldDescriptor","v","desc","self","newValue","_self","map","proxy","_receiver","namespace","NamedNodeMap","isNaN","Number","position","keys","msg","controller","rewriteCss","unrewriteCss","style","t","p","CSSStyleDeclaration","rewriteHtml","htmlRules","unrewriteHtml","rewriteJs","encoder","TextEncoder","bytesToBase64","bytes","binString","byte","String","btoa","attrObject","urlinterfaces","originalhrefs","attrs","attr","element","urlprops","i","href","node","Document","attrib","attrNames","cleaned","ruleList","rule","_ctx","_namespace","newval","scriptSource","atob","realwin","newclient","doc","scram","UrlChangeEvent","f","win","flagEnabled","order","enabled","disabled","_client","Navigator","registrationmap","WeakMap","registration","fakeRegistration","EventTarget","worker","handle","state","index","realLocalStorage","property","attributes","localStorageProxy","sessionStorageProxy","Event","ScramjetContextEvent","window","UNSAFE_GLOBALS","realDescriptor","loadCodecs","ScramjetServiceWorkerRuntime","Window","isworker","issw","isdedicated","isshared","isemulatedsw","dbg","runtime","contextev","urlchangeev","document","Location","fakeLocation","descriptorSource","native","nativeFunction","log","_v","rewriteBlob","unrewriteBlob","argdbg","arg","recurse","Symbol","ar","scramerr","e","scramdbg","closure","error","stack","newstack","lines","line","l","_value","js","rewritten","indirectEval","strict","indirection","Function","unproxy","realOnEvent","handlers","wraplistener","listener","realEvent","type","_target","reciever","rv","origlistener","proxylistener","arr","targets","rewriteFunction","stringifiedFunction","content","resolved","rootPromise","root","directory","POLLUTANT","pollutant","callerGlobalThisProxied","callerClient","wrappedPostMessage","toproxy","pollution","socketmap","socketstreammap","fakeWebSocket","trustEvent","barews","fakeEventSend","fakeev","CloseEvent","payload","Blob","ArrayBuffer","MessageEvent","ws","openResolver","closeResolver","ReadableStream","WritableStream","chunk","ARGS","HEADERS","headers","sab","SharedArrayBuffer","view","DataView","now","performance","status","headersLength","headersab","Uint8Array","TextDecoder","bodyLength","bodyab","body","parser","DOMParser","header","re","RegExp","match","SCRAMJETCLIENTNAME","RewriteType","getEnd","rewrite","scramtag_ident","searchRewrites","tag","searchFrame","globalThis1","rewrites","registerRewrites","buf","sourcemap","decoder","rewritelen","cursor","start","size","end","len","str","doUnrewrite","stringified","scramtagstart","firstspace","abstagindex","parseInt","absindex","endindex","scramtagend","fnrewrites","newString","lastpos","self1","globalThis","before","after","duration","timespan","getCtx","setCtx","BareMuxConnection","call","conn","port","identifier","eval","current","test","lhs","op","rhs","locationProxy","cevent","event","handleMessage","_e","token","fetchhandlers","request","Request","fakeRequest","Headers","fakeFetchEvent","responded","response","message","_reciever","severity","old","_","fmt","Math","bg","fg","padding","COMMITHASH","VERSION","$scramjet","flag","regex","partialflags","ScramjetHeaders","rewriteSrcset","rewriteHeaders","rewriteWorkers","initSync","rewrite_js","rewrite_js_from_arraybuffer","c","asyncInitRewriter","fetch","rewriteJsWasm","input","source","meta","WebAssembly","out","err1","scramtag","errors","overhead","rewriteJsNaiive","rewriteJsInner","text","rewriteJsWithMap","tryCanParseURL","origin","blob","realUrl","prefixed"],"mappings":"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,OAAO,GAAG,CAACwF,oBAAoB;AACtD,MAAM/Q,gBAAgBuL,OAAO,GAAG,CAAC,yBAAyB;;;;;;;;;;;;;;ACFjE;AACO;AACP;AACA;AACA;AACA;;;;;;;;;;;;;;;;;ACNuE;;AAEvE;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;;AAEA,2FAA2F,8BAA8B,MAAM,gBAAgB,6CAA6C;;AAE5L,0CAA0C;;AAE1C;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA,6FAA6F,gBAAgB,6CAA6C;;AAE1J;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA,WAAW,cAAc;AACzB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,WAAW,SAAS;AACpB,WAAW,QAAQ;AACnB,aAAa;AACb;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,YAAY;AACvB,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,WAAW,SAAS;AACpB,WAAW,QAAQ;AACnB,aAAa;AACb;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,cAAc;AACd;AACA;;AAEA,kBAAkB;AAClB;AACA;AACA;AACA;;AAEA;AACA;;AAEA,MAAM;AACN;;AAEA;AACA,qBAAqB;;AAErB,UAAU;AACV;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2DAA2D;AAC3D;AACA;AACA,KAAK;AACL,2DAA2D;AAC3D;AACA;AACA,KAAK;AACL,2DAA2D;AAC3D;AACA;AACA,KAAK;AACL,0DAA0D;AAC1D;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,0DAA0D;AAC1D;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kEAAkE;AAClE;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,oFAAQ;AAC5B;AACA;AACA;AACA;AACA;AACA,0DAA0D;AAC1D;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,2DAA2D,qCAAqC;AAChG;;AAEA;AACA;AACA;AACA;AACA;;AAEA,6JAA6J;AAC7J;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,cAAc,mCAAmC;AACjD,UAAU;AACV,wEAAwE;AACxE;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,cAAc,2CAA2C;AACzD,UAAU;AACV,uFAAuF;AACvF;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,YAAY,mBAAmB;;AAE/B;AACA;;AAEoB;AACpB,6DAAe,UAAU,EAAC"}